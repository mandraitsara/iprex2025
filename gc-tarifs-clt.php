<?php/**------------------------------------------------------------------------PAGE - ADMIN - Gescom - Tarifs ClientsCopyright (C) 2020 Intersedhttp://www.intersed.fr/------------------------------------------------------------------------@author    Cédric Bouillon@copyright Copyright (c) 2020 Intersed@version   1.0@since     2020------------------------------------------------------------------------ */require_once 'scripts/php/config.php';require_once 'scripts/php/check_admin.php';$id_client = isset($_REQUEST['c']) ? intval(base64_decode($_REQUEST['c'])) : 0;$tiersManager = new TiersManager($cnx);$client = $id_client > 0 ? $tiersManager->getTiers($id_client) : new Tiers([]);$h1     = $id_client > 0 ? 'Tarifs ' . $client->getNom() : 'Tarifs clients';$h1.= $id_client > 0 ? '<a href="admin-clients.php" class="float-right btn btn-secondary btn-sm margin-right-5"><i class="fa fa-undo-alt gris-c mr-1"></i> Retour à la liste</a>' : '';$h1fa   = $id_client > 0 ? 'fa-fw fa-calculator' : 'fa-fw fa-address-card';include('includes/header.php');$erreurs = [    1 => "Ficher absent ou client incorrect !",    2 => "Aucune ligne à importer dans le fichier sélectionné (vérifiez les codes articles).",    3 => "Echec lors du nettoyage des anciens tarifs clients.",    4 => "Echec lors de l'import des données en base."];// Gestion des messages d'erreur$errCode = isset($_REQUEST['e']) ? intval(base64_decode($_REQUEST['e'])) : 0;if ($errCode > 0) { ?>    <div class="alert alert-danger alert-dismissible margin-top--10">        <button type="button" class="close" data-dismiss="alert">&times;</button>        <strong>ERREUR !</strong> <?php echo $erreurs[$errCode]?>    </div><?php } // FIN erreurs// Retour positif$lignesImportes = isset($_REQUEST['i']) ? intval(base64_decode($_REQUEST['i'])) : 0;if ($lignesImportes > 0) { ?>    <div class="alert alert-success alert-dismissible margin-top--10">        <button type="button" class="close" data-dismiss="alert">&times;</button>        <i class="fa fa-check mr-1"></i><strong class="mr-3">IMPORT TERMINÉ</strong> <?php        echo $lignesImportes > 1 ? "<span class='badge badge-success text-18'>". $lignesImportes. "</span> tarifs ont été importés avec succès." : " Un tarif a été importé avec succès."; ?>    </div><?php } // FIN retour positif?><input type="hidden" id="clientFixe" value="<?php echo $id_client; ?>"/><div class="container-fluid page-admin">    <div class="row">        <div class="col-12 col-xl-10" id="listeTarifs"><i class="fa fa-spin fa-spinner fa-2x"></i></div>        <div class="col-12 col-xl-2 text-right boutons-droite-selpdt hid position-fixed">            <div class="alert alert-secondary">                <input type="text" class="form-control mb-2" id="ctrlf" placeholder="Recherche..." value=""/>                <button type="button" class="btn btn-success form-control text-left pl-3 btnSaveAssoPdtClt"><i class="fa fa-save fa-fw fa-lg mr-2"></i>Enregistrer</button>            </div>        </div>        <div class="col-12 col-xl-2 text-right boutons-droite">            <div class="alert alert-secondary">                <button type="button" class="btn btn-info form-control text-left pl-3 <?php echo $id_client > 0 ? 'd-none' : ''; ?>" data-toggle="modal" data-target="#modalTarif"><i class="fa fa-plus-square fa-lg fa-fw mr-2"></i>Ajouter un tarif&hellip;</button>                <button type="button" class="btn btn-info form-control text-left btnSelectionPdtsClientFixe pl-3 <?php echo $id_client == 0 ? 'd-none' : ''; ?>"><i class="fa fa-check-square fa-lg fa-fw mr-2"></i>Sélection des produits&hellip;</button>                <button type="button" class="btn btn-secondary form-control text-left pl-3 mt-2 btnImportCsv <?php echo $id_client > 0 ? 'd-none' : ''; ?>"><i class="fa fa-cloud-upload-alt fa-fw fa-lg mr-2"></i>Importer&hellip;</button>                <!-- On masque ici l'export en CSV le client n'en vois pas l'intéret -->                <button type="button" class="btn btn-secondary form-control text-left pl-3 mt-2 btnExportCsv d-none"><i class="fa fa-file-csv fa-fw fa-lg mr-2"></i>Exporter en CSV</button>                <!-- Fin -->                <button type="button" class="btn btn-secondary form-control text-left pl-3 mt-2 btnExportPdf" data-id-client="<?php echo $id_client; ?>"><i class="fa fa-file-pdf fa-fw fa-lg mr-2"></i>Exporter en PDF</button>                <?php if ($id_client > 0) { ?>                    <button type="button" class="btn btn-secondary form-control text-left pl-3 mt-2 btnEnvoirPdfMail" data-id-client="<?php echo $id_client; ?>" data-toggle="modal" data-target="#modalEnvoiMail"><i class="fa fa-paper-plane fa-fw fa-lg mr-2"></i>Envoyer par e-mail</button>                <?php } ?>                <a href="" target="_blank" download id="lienExport"></a>                <button type="button" class="btn btn-success form-control text-left pl-3 mt-2 btnSaveTousTarifs"><i class="fa fa-save fa-fw fa-lg mr-2"></i>Enregistrer</button>            </div>        </div>    </div></div><?phpinclude('includes/modales/modal_envoi_mail.php');include('includes/modales/modal_tarif.php');include('includes/modales/modal_import_tarifs.php');include('includes/footer.php');