<?php/**------------------------------------------------------------------------PAGE - DEV - Taches CRONCopyright (C) 2019 Intersedhttp://www.intersed.fr/------------------------------------------------------------------------@author    Cédric Bouillon@copyright Copyright (c) 2019 Intersed@version   1.0@since     2018------------------------------------------------------------------------ */require_once 'scripts/php/config.php';// Vérifie une authentification par login/mdp adminrequire_once 'scripts/php/check_admin.php';// On restreint la page aux Administrateurs Devéloppeursif (!$utilisateur->isDev()) {  header('Location: index.php'); }$documentsManager = new DocumentManager($cnx);$cronsManager     = new CronsManager($cnx);$h1     = 'Tâches CRON';$h1fa   = 'fa-fw fa-robot';include('includes/header.php');$id  = isset($_REQUEST['id'])  ? intval($_REQUEST['id'])  : 0;$val = isset($_REQUEST['val']) ? intval($_REQUEST['val']) : -1;if ($id > 0 && $val >=0 ) {    $cron = $cronsManager->getCron($id);    if ($cron instanceof Cron) {        $cron->setActif($val);		$cronsManager->saveCron($cron);    }}$crons = $cronsManager->getListeCrons();?><div class="container-fluid">    <div class="row">        <div class="col-12">            <?php            if (!$crons || empty($crons)) { ?>                <div class="alert alert-info">                    <i class="fa fa-info-circle mr-1"></i>                   Aucune tâche CRON enregistrée !                </div>            <?php }            ?>            <table class="admin w-100">                <thead>                <tr>                    <th>Fichier</th>                    <th>Description</th>                    <th>Chemin</th>                    <th class="text-center">m</th>                    <th class="text-center">H</th>                    <th class="text-center">jMois</th>                    <th class="text-center">M</th>                    <th class="text-center">jSem</th>                    <th>Dernière exécution</th>                    <th class="t-actions w-mini-admin-cell">Activation</th>                    <th class="t-actions w-mini-admin-cell">Exécuter</th>                </tr>                </thead>                <tbody>                <?php foreach ($crons as $cron) { ?>                    <tr>                        <td><kbd><?php echo $cron->getFichier(); ?></kbd></td>                        <td><?php echo $cron->getDescription();                        echo $cron->getInfo() != '' ? '<div class="text-danger"><i class="fa fa-exclamation-triangle mr-1"></i> '.$cron->getInfo().'</div>' : '';                        ?></td>                        <td><code><?php echo $cron->getChemin(); ?></code></td>                        <td class="text-center"><code><?php echo $cron->getMinute(); ?></code></td>                        <td class="text-center"><code><?php echo $cron->getHeure(); ?></code></td>                        <td class="text-center"><code><?php echo $cron->getJour_mois(); ?></code></td>                        <td class="text-center"><code><?php echo $cron->getMois(); ?></code></td>                        <td class="text-center"><code><?php echo $cron->getJour_sem(); ?></code></td>                        <td><?php echo $cron->getExecution() != '' ? $cron->getExecution() : 'Jamais' ; ?></td>                        <td class="t-actions w-mini-admin-cell">                            <input type="checkbox" class="togglemaster" data-size="small" data-toggle="toggle" data-on="Oui" data-off="Non" data-onstyle="success" data-offstyle="danger" data-id="<?php echo $cron->getId(); ?>" <?php							echo (int)$cron->isActif() ? 'checked' : ''; ?>/>                        </td>                        <td class="t-actions w-mini-admin-cell">                            <a href="<?php echo __CBO_ROOT_URL__.$cron->getChemin().$cron->getFichier().'.php'; ?>?show_debug&debug" target="_blank" class="btn btn-dark btn-sm btnExecuteCron">                                <i class="fa fa-play"></i>                            </a>                        </td>                    </tr>                <?php } ?>                </tbody>            </table>        </div>    </div></div><?phpinclude('includes/footer.php');