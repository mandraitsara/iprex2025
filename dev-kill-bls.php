<?php/**------------------------------------------------------------------------PAGE - DEV - Suppression des BLsCopyright (C) 2020 Intersedhttp://www.intersed.fr/------------------------------------------------------------------------@author    Cédric Bouillon@copyright Copyright (c) 2020 Intersed@version   1.0@since     2018------------------------------------------------------------------------ */require_once 'scripts/php/config.php';// Vérifie une authentification par login/mdp adminrequire_once 'scripts/php/check_admin.php';// On restreint la page aux Administrateurs Devéloppeursif (!$utilisateur->isDev()) {  header('Location: index.php'); }$blManager      = new BlManager($cnx);$tiersManager   = new TiersManager($cnx);$h1     = 'BLs supprimés';$h1fa   = 'fa-fw fa-trash-alt';include('includes/header.php');if (isset($_REQUEST['purge'])) { $blManager->killSupprimes(); } // FIN purgeif (isset($_REQUEST['killpdf'])) { $blManager->supprPdfBlsHorsBdd(); } // FIN purge$params     = ['supprime' => 1];$listeBls   = $blManager->getListeBl($params);?><div class="container-fluid">    <div class="row">        <div class="col">            <div class="row">                <div class="col-10">            <?php            // Pas de BL            if (empty($listeBls)) { ?>                <div class="alert alert-info">                    <i class="fa fa-info-circle fa-lg mr-1"></i> Aucun BL supprimé.                </div>            <?php            // Des BL supprimés ont été trouvés            } else { ?>                <table class="admin w-100">                    <thead>                    <tr>                        <th class="text-center">ID</th>                        <th>Date</th>                        <th class="nowrap">N° BL</th>                        <th>Client</th>                        <th class="nowrap">Statut</th>                        <th class="text-center">Nb lignes</th>                    </tr>                    </thead>                    <tbody>                    <?php                    foreach ($listeBls as $bl) {                        $client = $tiersManager->getTiers($bl->getId_tiers_livraison());                        if (!$client instanceof Tiers) { $client = new Tiers([]); }                        ?>                        <tr>                            <td class="w-minimax-admin-cell text-center"><span class="badge badge-pill badge-warning badge-id"><?php echo $bl->getId();?></span></td>                            <td><?php echo Outils::dateSqlToFr($bl->getDate()); ?></td>                            <td><?php echo $bl->getNum_bl(); ?></td>                            <td><?php echo $client->getNom(); ?></td>                            <td><?php echo $bl->getStatut_verbose(); ?></td>                            <td class="text-center"><?php echo count($bl->getLignes()); ?></td>                        </tr>                    <?php } ?>                    </tbody>                </table>			<?php            } // FIN test bls supprimées ?>                </div>                <div class="col-2">                    <a href="<?php echo $_SERVER['PHP_SELF']; ?>?killpdf" class="btn btn-danger form-control" onclick="return confirm('Supprimer définitivement les PDF du serveur ?');"><i class="fa fa-server mr-1"></i> Effacer PDF orphelins</a>                    <?php   if (!empty($listeBls)) { ?>                        <a href="<?php echo $_SERVER['PHP_SELF']; ?>?purge" class="btn btn-danger mt-2 btnPurgerTout form-control" onclick="return confirm('Détruire définitivement les BLs supprimés et toutes leurs dépendances ? \r\nLes factures correspondantes seront supprimées par flag.');"><i class="fa fa-trash-alt mr-1"></i> Purger tout</a>                        <div class="alert alert-danger mt-2 text-justify texte-fin text-12">                            <i class="fa fa-exclamation-triangle mr-1"></i> Afin de garantir la traçabilité et le référentiel ITIL, les BLs ne peuvent être supprimés définitivement que par les développeurs dans le cadre de tests.                        </div>                    <?php } ?>                </div>            </div>        </div>    </div></div><?phpinclude('includes/footer.php');