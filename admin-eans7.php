<?php/**------------------------------------------------------------------------PAGE - ADMIN - ProduitsCopyright (C) 2018 Intersedhttp://www.intersed.fr/------------------------------------------------------------------------@author    Cédric Bouillon@copyright Copyright (c) 2018 Intersed@version   1.0@since     2018------------------------------------------------------------------------ */ini_set('display_errors',1);require_once 'scripts/php/config.php';require_once 'scripts/php/check_admin.php';$produitsManager    = new ProduitManager($cnx);$logsManager        = new LogManager($cnx);$h1     = 'Plages des EAN7';$h1fa   = 'fa-fw fa-barcode';// Si soumission du formulaire$min        = isset($_REQUEST['min'])   ? intval($_REQUEST['min'])  : 0;$max        = isset($_REQUEST['max'])   ? intval($_REQUEST['max'])  : 0;$upd_min    = isset($_REQUEST['umin'])  ? intval($_REQUEST['umin']) : 0;$upd_max    = isset($_REQUEST['umax'])  ? intval($_REQUEST['umax']) : 0;$id_upd     = isset($_REQUEST['u'])     ? intval($_REQUEST['u'])    : 0;$id_kill    = isset($_REQUEST['k'])     ? intval($_REQUEST['k'])    : 0;// Si nouvelle plageif ($min > 0 && $max > $min) {    if ($produitsManager->isPlageDispo($min, $max)) {        $res = $produitsManager->addPlage($min,$max);        $log = new Log([]);        $logTxt = $res ? 'C' : 'Echec de la c';        $logTxt.="réation d'une plage de séquence d'EAN 7 (".$min."-".$max.")";        $logType = $res ? 'info' : 'danger';        $log->setLog_type($logType);        $log->setLog_texte($logTxt);		$logsManager->saveLog($log);    } // FIN test plage ne chauvauche pas} // FIN test formulaire nouvelle plage// Si supprimer une plageif ($id_kill > 0) {    $res = $produitsManager->supprPlageEan7($id_kill);	$log = new Log([]);	$logTxt = $res ? 'S' : 'Echec de la s';	$logTxt.="uppression d'une plage de séquence d'EAN 7 (#".$id_kill.")";	$logType = $res ? 'info' : 'danger';	$log->setLog_type($logType);	$log->setLog_texte($logTxt);	$logsManager->saveLog($log);} // FIN supprimer// Si update d'une plageif ($id_upd > 0 && $upd_min > 0 && $upd_max > $upd_min) {    // On s'assure que la plage n'entre pas en conflit avec une autre...    if ($produitsManager->isPlageDispo($upd_min, $upd_max, $id_upd)) {		$res = $produitsManager->updatePlage($id_upd, $upd_min, $upd_max);		$log = new Log([]);		$logTxt = $res ? 'M' : 'Echec de la m';		$logTxt.="odification de la plage de séquence d'EAN 7 (#".$id_upd.")";		$logType = $res ? 'info' : 'danger';		$log->setLog_type($logType);		$log->setLog_texte($logTxt);		$logsManager->saveLog($log);    } // FIN test la plage n'entre pas en conflit} // FIN test updateinclude('includes/header.php');$plages = $produitsManager->getPlagesEan7();?><div class="container-fluid page-admin">    <div class="alert alert-danger d-xl-none  d-none d-md-block">        <i class="fa fa-exclamation-circle text-28 mr-1 v-middle"></i>Connectez-vous depuis un apareil permettant un affichage plus large pour afficher les filtres et les codes&hellip;    </div>    <div class="row margin-bottom-50">        <div class="col-12 col-xl-4 offset-xl-3">            <table class="table admin table-v-middle">                <thead>                <tr>                    <th class="text-center">Début</th>                    <th class="text-center">Fin</th>                    <th class="text-center">Capacité</th>                    <th class="text-center">Utilisations</th>                    <th class="t-actions text-center">Modifier</th>                    <th class="t-actions text-center">Supprimer</th>                </tr>                </thead>                <tbody>                <?php                foreach ($plages as $plage) {                    $nbUtilisations = (int)$produitsManager->getNbUtilisationsPlageEan7($plage['id']);                    ?>                    <tr data-id="<?php echo intval($plage['id']); ?>">                        <td class="text-center text-20">                            <input type="text" class="form-control hid edit-min text-center" placeholder="Début" maxlength="6" value="<?php                            echo intval($plage['min']); ?>"/>                            <span class="show-min"><?php echo intval($plage['min']); ?></span>                        </td>                        <td class="text-center text-20">                            <input type="text" class="form-control hid edit-max text-center" placeholder="Fin" maxlength="6" value="<?php                            echo intval($plage['max']); ?>"/>                            <span class="show-max"><?php echo intval($plage['max']); ?></span>                        </td>                        <td class="text-center"><?php echo intval($plage['max']) - intval($plage['min']); ?></td>                        <td class="text-center"><?php echo $nbUtilisations > 0 ? $nbUtilisations : '<span class="gris-9">Aucune</span>'; ?></td>                        <td class="t-actions text-center">                            <button type="button" class="btn btn-success btn-sm btnUpdPlage hid"><i class="fa fa-save fa-fw"></i></button>                            <button type="button" class="btn btn-secondary btn-sm btnEditPlage <?php                            echo $nbUtilisations > 0 ? 'disabled' : ''; ?>" <?php                            echo $nbUtilisations > 0 ? 'disabled' : ''; ?>><i class="fa fa-edit fa-fw"></i></button>                        </td>                        <td class="t-actions text-center">                            <button type="button" class="btn btn-danger btn-sm btnSupprPlage <?php							echo $nbUtilisations > 0 ? 'disabled' : ''; ?>" <?php                            echo $nbUtilisations > 0 ? 'disabled' : ''; ?>><i class="fa fa-trash-alt fa-fw"></i></button>                        </td>                    </tr>                <?php }                ?>                </tbody>            </table>        </div>        <div class="col-12 offset-xl-3 col-xl-2 text-right boutons-droite d-none d-md-block">            <div class="alert alert-secondary">                <form action="<?php echo $_SERVER['PHP_SELF']; ?>" method="post">                    <div class="input-group mb-1">                        <div class="input-group-prepend">                            <span class="input-group-text"><i class="fa fa-step-backward"></i></span>                        </div>                        <input type="text" class="form-control" placeholder="Début" name="min" maxlength="6" />                    </div>                    <div class="input-group mb-1">                        <div class="input-group-prepend">                            <span class="input-group-text"><i class="fa fa-step-forward"></i></span>                        </div>                        <input type="text" class="form-control" placeholder="Fin" name="max" maxlength="6" />                    </div>                    <button type="submit" class="btn btn-success form-control"><i class="fa fa-plus-circle mr-1"></i> Ajouter cette plage</button>                </form>                <a href="<?php echo __CBO_ROOT_URL__; ?>admin-eans.php" class="btn btn-dark form-control text-left pl-3 mt-2 mb-2"><i class="fa fa-barcode fa-fw fa-lg mr-2"></i>Liste des EAN&hellip;</a>            </div>        </div>    </div></div><?phpinclude('includes/footer.php');