<?php/**------------------------------------------------------------------------PAGE - DEV - Suppression des facturesCopyright (C) 2020 Intersedhttp://www.intersed.fr/------------------------------------------------------------------------@author    Cédric Bouillon@copyright Copyright (c) 2020 Intersed@version   1.0@since     2018------------------------------------------------------------------------ */require_once 'scripts/php/config.php';// Vérifie une authentification par login/mdp adminrequire_once 'scripts/php/check_admin.php';// On restreint la page aux Administrateurs Devéloppeursif (!$utilisateur->isDev()) {  header('Location: index.php'); }$facturesManager = new FacturesManager($cnx);$tiersManager    = new TiersManager($cnx);$h1     = 'Factures et avoirs supprimés';$h1fa   = 'fa-fw fa-trash-alt';include('includes/header.php');if (isset($_REQUEST['purge']))   { $facturesManager->killSupprimees(); } // FIN purge$params = ['supprime' => 1, 'bls' => false];$listeFactures = $facturesManager->getListeFactures($params);?><div class="container-fluid">    <div class="row">        <div class="col">            <div class="row">                <div class="col-10">                <?php                // Pas de facture                if (empty($listeFactures)) { ?>                    <div class="alert alert-info">                        <i class="fa fa-info-circle fa-lg mr-1"></i> Aucune facture supprimée.                    </div>                <?php                // Des factures supprimées ont été trouvées                } else { ?>                    <table class="admin w-100">                        <thead>                        <tr>                            <th class="text-center">ID</th>                            <th>Date</th>                            <th class="nowrap">N° Facture</th>                            <th>Client</th>                            <th class="nowrap">Montant HT</th>                            <th class="text-center">Nb lignes</th>                        </tr>                        </thead>                        <tbody>                        <?php                        foreach ($listeFactures as $facture) {                            $client = $tiersManager->getTiers($facture->getId_tiers_facturation());                            ?>                            <tr>                                <td class="w-minimax-admin-cell text-center"><span class="badge badge-pill badge-warning badge-id"><?php echo $facture->getId();?></span></td>                                <td><?php echo Outils::dateSqlToFr($facture->getDate()); ?></td>                                <td><?php echo $facture->getNum_facture(); ?></td>                                <td><?php echo $client->getNom(); ?></td>                                <td><?php echo $facture->getMontant_ht(); ?></td>                                <td class="text-center"><?php echo count($facture->getLignes()); ?></td>                            </tr>                        <?php } ?>                        </tbody>                    </table>                <?php                } // FIN test factures supprimées ?>                </div>                <div class="col-2">                    <a href="<?php echo $_SERVER['PHP_SELF']; ?>?killpdf" class="btn btn-danger form-control" onclick="return confirm('Supprimer définitivement les PDF du serveur ?');"><i class="fa fa-server mr-1"></i> Effacer PDF orphelins</a>                    <?php   if (!empty($listeFactures)) { ?>                        <a href="<?php echo $_SERVER['PHP_SELF']; ?>?purge" class="btn btn-danger mt-2 btnPurgerTout form-control" onclick="return confirm('Détruire définitivement les factures et avoirs supprimés et toutes leurs dépendances ?');"><i class="fa fa-trash-alt mr-1"></i> Purger tout</a>                        <div class="alert alert-danger mt-2 text-justify texte-fin text-12">                            <i class="fa fa-exclamation-triangle mr-1"></i> Afin de garantir la traçabilité et le référentiel ITIL, les factures ne peuvent être supprimés définitivement que par les développeurs dans le cadre de tests.                        </div>                    <?php } ?>                </div>            </div>        </div>    </div></div><?phpinclude('includes/footer.php');