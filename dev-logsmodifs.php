<?php/**------------------------------------------------------------------------PAGE - DEV - Logs des modificationsCopyright (C) 2019 Intersedhttp://www.intersed.fr/------------------------------------------------------------------------@author    Cédric Bouillon@copyright Copyright (c) 2019 Intersed@version   1.0@since     2018------------------------------------------------------------------------ */require_once 'scripts/php/config.php';// Vérifie une authentification par login/mdp adminrequire_once 'scripts/php/check_admin.php';// On restreint la page aux Administrateurs Devéloppeursif (!$utilisateur->isDev()) {  header('Location: index.php'); }$h1     = 'Historique des modifications ';$h1fa   = 'fa-fw fa-highlighter';include('includes/header.php');$modifsManager = new ModificationManager($cnx);$page = isset($_REQUEST['page']) ? $_REQUEST['page'] : 1;$pagination = new Pagination($page);$pagination->setNb_results_page(20);$pagination->setNb_avant(3);$pagination->setNb_apres(3);$params['start'] = $pagination->getStart();$params['nb_results_p_page'] = $pagination->getNb_results_page();// Filtres$regexDateFr =  '#^(([1-2][0-9]|0[1-9]|[3][0-1])\/([0][1-9]|[1][0-2])\/[2][0-9][0-9]{2})$#';$filtre_debut           = isset($_REQUEST['filtre_debut'])  && preg_match($regexDateFr, $_REQUEST['filtre_debut'])  ? $_REQUEST['filtre_debut']  : '';$filtre_fin             = isset($_REQUEST['filtre_fin'])    && preg_match($regexDateFr, $_REQUEST['filtre_fin'])    ? $_REQUEST['filtre_fin']    : '';if ($filtre_debut != '' ) { $params['debut'] = $filtre_debut;  }if ($filtre_fin   != '' ) { $params['fin']   = $filtre_fin;    }// Filtres pour pagination et redirections formulaires$filtres = '';$filtres.= isset($_REQUEST['filtre_debut'])		    ? ($filtres != '' ? '&' : '?').'filtre_debut='      .$filtre_debut          : '';$filtres.= isset($_REQUEST['filtre_fin'])		    ? ($filtres != '' ? '&' : '?').'filtre_fin='        .$filtre_fin            : '';$filtresPagination = $filtres;$pagination->setUrl($filtresPagination);$listeModifs= $modifsManager->getListeModifications($params);$pagination->setNb_results(!empty($listeModifs) ? $modifsManager->getNb_results() : 0);?><div class="container-fluid">    <div class="row">        <div class="col" id="listeLogs">            <form action="<?php echo $_SERVER['PHP_SELF']; ?>" method="post">                <div class="row">                    <input type="hidden" name="page" value="1" />                    <div class="col-2 mb-2">                        <div class="input-group mb-3">                            <div class="input-group-prepend">                                <span class="input-group-text">Du&hellip;</span>                            </div>                            <input type="text" class=" datepicker form-control" placeholder="Début" name="filtre_debut" value="<?php echo $filtre_debut; ?>">                            <div class="input-group-append">                                <span class="input-group-text" ><i class="fas fa-calendar-alt"></i></span>                            </div>                        </div>                    </div>                    <div class="col-2 mb-2">                        <div class="input-group mb-3">                            <div class="input-group-prepend">                                <span class="input-group-text" >&hellip;au</span>                            </div>                            <input type="text" class=" datepicker form-control" placeholder="Fin" name="filtre_fin" value="<?php echo $filtre_fin; ?>">                            <div class="input-group-append">                                <span class="input-group-text" ><i class="fas fa-calendar-alt"></i></span>                            </div>                        </div>                    </div>                    <div class="col mb-2">                        <button type="submit" class="btn btn-secondary"><i class="fa fa-search mr-1"></i> Rechercher&hellip;</button>                        <a href="<?php echo $_SERVER['PHP_SELF'];?>" class="btn btn-outline-secondary"><i class="fa fa-backspace"></i></a>                    </div>                </div>            </form>            <?php            // Pas de mail            if (empty($listeModifs)) { ?>                <div class="alert alert-secondary">                    Aucune modification historisée...                </div>            <?php            // Des mails ont été trouvés            } else {				?>                <table class="admin w-100">                    <thead>                    <tr>                        <th class="text-center">ID</th>                        <th>Date/heure</th>                        <th>Administrateur</th>                        <th class="text-center">ID Froid</th>                        <th class="text-center">ID FroidProduit</th>                        <th>Attribut</th>                        <th>Ancienne valeur</th>                        <th>Nouvelle valeur</th>                    </tr>                    </thead>                    <tbody>					<?php					foreach ($listeModifs as $modif) { ?>                        <tr>                            <td class="text-center"><span class="badge badge-warning badge-pill text-12"><?php echo $modif->getId(); ?></span></td>                            <td><?php echo Outils::getDate_verbose($modif->getDate()); ?></td>                            <td><?php echo $modif->getNom_user(); ?></td>                            <td class="text-center"><?php echo $modif->getId_froid() > 0 ? '<code>'.$modif->getId_froid().'</code>' : '<span class="gris-9">&mdash;</span>'; ?></td>                            <td class="text-center"><?php echo $modif->getId_lot_pdt_froid() > 0 ? '<code>'.$modif->getId_lot_pdt_froid().'</code>' : '<span class="gris-9">&mdash;</span>'; ?></td>                            <td><code><?php echo $modif->getChamp();?></code></td>                            <td><code><?php echo $modif->getValeur_old();?></code></td>                            <td><code><?php echo $modif->getValeur_new();?></code></td>                        </tr>					<?php } ?>                    </tbody>                </table>				<?php				if (isset($pagination)) {					// Pagination bas de page, verbose...					$pagination->setVerbose_pagination(1);					$pagination->setVerbose_position('right');					$pagination->setNature_resultats('mail');					echo $pagination->getPaginationHtml();				}			} // FIN test résultats            ?>        </div>    </div></div><?phpinclude('includes/footer.php');