<?php/**------------------------------------------------------------------------PAGE - ADMIN - Types de documentsCopyright (C) 2018 Intersedhttp://www.intersed.fr/------------------------------------------------------------------------@author    Cédric Bouillon@copyright Copyright (c) 2018 Intersed@version   1.0@since     2018------------------------------------------------------------------------ */require_once 'scripts/php/config.php';// Vérifie une authentification par login/mdp adminrequire_once 'scripts/php/check_admin.php';// On restreint la page aux Administrateursif (!$utilisateur->isAdmin()) {  header('Location: index.php'); }$h1     = 'Gestion des types de documents';$h1fa   = 'fa-fw fa-copy';include('includes/header.php');$documentsTypesManager = new DocumentsTypeManager($cnx);$name_new_type  = isset($_REQUEST['nom'])   ? trim($_REQUEST['nom'])                 : false;$kill_type_id   = isset($_REQUEST['kt'])    ? intval(base64_decode($_REQUEST['kt'])) : false;// SI on a posté le formulaire : création d'un nouveau type de document...if ($name_new_type && $name_new_type != '') {    $actif = isset($_REQUEST['actif']) ? 1 : 0;    $documents_type = new DocumentsType([]);	$documents_type->setNom($name_new_type);	$documents_type->setActif($actif);	$documentsTypesManager->saveDocumentsType($documents_type);} // FIN test formulaire envoyé// SI on supprime un type de documentif ($kill_type_id && (int)$kill_type_id > 0) {    $doc2kill = $documentsTypesManager->getDocumentsType($kill_type_id);    if ($doc2kill instanceof DocumentsType) {        // On vérifie que le type n'est pas vérouillé ou utilisé par l'API        if (!$doc2kill->isLocked() && (int)$doc2kill->getApi() == 0) {			$documentsTypesManager->supprimeDocumentsType($doc2kill);        }    } // FIN test document instancié} // FIN test suppresion d'un doc demandé$listeTypes = $documentsTypesManager->getListeDocumentsTypes();?><div class="container-fluid">    <?php if (empty($listeTypes)) { ?>        <div class="alert alert-danger"><i class="fa fa-exclamation-triangle fa-lg mr-1"></i>Aucun type de document disponible !</div>    <?php } else { ?>    <table class="admin w-100">        <thead>            <tr>	            <?php if ($utilisateur->isDev()) { ?>                <th class="w-court-admin-cell">ID</th>	            <?php } ?>                <th>Libellé</th>                <th class="text-center">Nombre de documents</th>                <th class="text-center">Activation</th>                <th class="w-court-admin-cell text-center t-actions">Supprimer</th>            </tr>        </thead>        <tbody>            <?php            foreach ($listeTypes as $documents_type) {				$nbDocs = $documentsTypesManager->getNbDocumentsByType($documents_type);                ?>                <tr>                    <?php if ($utilisateur->isDev()) { ?>                    <td><span class="badge badge-pill badge-warning badge-id"><?php echo $documents_type->getId(); ?></span></td>                    <?php } ?>                    <td class="text-20"><?php echo $documents_type->getNom(); ?></td>                    <td class="text-center"><span class="badge badge-pill badge-info text-16"><?php echo $nbDocs; ?></span></td>                    <td class="text-center">                        <?php if ($documents_type->isLocked()) { ?>                                <i class="fa fa-2x gris-9 fa-lock"></i>                        <?php } else { ?>                                <input type="checkbox" class="togglemaster changeActivationTypeDoc" data-toggle="toggle" data-on="Oui" data-off="Non" data-onstyle="success" data-offstyle="danger" data-type-id="<?php                                echo $documents_type->getId(); ?>" <?php echo $documents_type->getActif() == 1 ? 'checked' : ''; ?>/>                        <?php } ?>                    </td>                    <td class="w-court-admin-cell text-center t-actions">						<?php if ($documents_type->isLocked()) { ?>                            <i class="fa fa-2x gris-9 fa-lock"></i>						<?php } else { ?>                            <a href="<?php echo $_SERVER['PHP_SELF'];?>?kt=<?php echo base64_encode($documents_type->getId())?>" class="btn btn-sm btn-danger mr-1 btnSupprType <?php							echo $nbDocs > 0 ? 'disabled' : ''; ?>"><i class="fa fa-fw fa-lg fa-<?php								echo $nbDocs > 0 ? 'ban' : 'times'; ?>"></i></a>						<?php } ?>                    </td>                </tr>            <?php            } // FIN boucle            ?>        </tbody>    </table>    <?php } // FIN test types de documents trouvés    ?>    <form action="<?php echo $_SERVER['PHP_SELF']; ?>" method="post" class="alert alert-secondary mt-4">        <div class="row">            <div class="col-12 gris-7 padding-left-20 mb-1">                <i class="fa fa-plus-square mr-1 gris-7"></i>Ajouter un type de document&hellip;            </div>        </div>        <div class="row">            <div class="form-group col mb-0">                <div class="input-group">                    <div class="input-group-prepend">                        <span class="input-group-text"><i class="fa fa-tag"></i></span>                    </div>                    <input type="text" placeholder="Libellé" class="form-control" name="nom" value="">                </div>            </div>             <div class="form-group col mb-0">                <div class="input-group">                    <input type="checkbox" class="togglemaster" data-toggle="toggle" data-on="Activé" data-off="Désactivé" data-onstyle="success" data-offstyle="danger" name="actif" />                </div>            </div>            <div class="form-group col mb-0 text-right">                <button type="submit" class="btn btn-info"><i class="fa fa-check mr-1"></i>Ajouter</button>            </div>        </div>    </form></div><?phpinclude('includes/footer.php');