<?php/**------------------------------------------------------------------------PAGE - ADMIN - Gescom - BL - CréationCopyright (C) 2020 Intersedhttp://www.intersed.fr/------------------------------------------------------------------------@author    Cédric Bouillon@copyright Copyright (c) 2020 Intersed@version   1.0@since     2020------------------------------------------------------------------------ */require_once 'scripts/php/config.php';require_once 'scripts/php/check_admin.php';$h1     = 'Nouveau bon de livraison';$h1.= '<a href="gc-bls.php" class="float-right btn btn-secondary btn-sm margin-right-5"><i class="fa fa-undo-alt gris-c mr-1"></i> Retour à la liste</a>';$h1fa   = 'fa-fw fa-file-invoice';$css[] = 'css/rougetemp.css';include('includes/header.php');$id_bl_recup = isset($_REQUEST['idbl']) ? intval($_REQUEST['idbl']) : 0;$blmanager      = new BlManager($cnx);$tiersManager   = new TiersManager($cnx);$languesManager = new LanguesManager($cnx);$listeClients   = $tiersManager->getListeClients();$transporteurs  = $tiersManager->getListeTransporteurs();$langues        = $languesManager->getListeLangues(['actif' => 1]);$ids_langues = [];foreach ($langues as $l) { $ids_langues[] = $l->getId(); }if ($id_bl_recup > 0) {    $bl = $blmanager->getBl($id_bl_recup, false);    // SI on a pas affaire à un Bl temporaire (supprimé)    if (!$bl instanceof Bl || $bl->getSupprime() == 1) {        $id_bl_recup = 0;    }}// On crée un BL temporaire si on a pas instancié une repriseif ($id_bl_recup == 0) {	$bl = new Bl([]);	$num_bl = $blmanager->getNextNumeroBl();	$bl->setNum_bl($num_bl);	$bl->setSupprime(0);	$bl->setStatut(1);	$bl->setDate(date('Y-m-d'));	$id_bl = $blmanager->saveBl($bl);	$bl->setId($id_bl);	if (intval($id_bl) == 0) { exit('Création du BL temporaire échoué !'); }}$id_client_web = $tiersManager->getId_client_web();$web = $id_client_web > 0 && $bl->getId_tiers_facturation() == $id_client_web;?><div class="container-fluid">    <div class="row">        <div class="col-8" id="listeProduitsBl">            <i class="fa fa-spin fa-spinner gris-c fa-3x"></i>        </div>        <div class="col-4">            <form class="alert alert-secondary" id="formBl">                <input type="hidden" name="mode" value="saveBl" />                <input type="hidden" id="idClientWeb" value="<?php echo $id_client_web; ?>" />                <input type="hidden" name="statut" value="<?php echo $bl->getStatut(); ?>" />                <input type="hidden" name="id" value="<?php echo $bl->getId(); ?>" />                <div class="row mb-1">                    <div class="col-4 padding-top-10">                        <span class="gris-7">Numéro de BL</span>                    </div>                    <div class="col-8">                        <span class="text-24 text-uppercase"><?php echo $bl->getCode(); ?></span>                    </div>                </div>                <div class="row mb-1">                    <div class="col-4 padding-top-10">                        <span class="gris-7">Numéro de commande</span>                    </div>                    <div class="col-8">                        <input type="text" class="form-control text-24 text-uppercase"  placeholder="Numéro de commande" name="num_cmd" maxlength="32" id="num_cmd" value="<?php echo $bl->getNum_cmd(); ?>"/>                    </div>                </div>                <div class="row mb-1 d-none">                    <div class="col-4 padding-top-10">                        <span class="gris-7">Date</span>                    </div>                    <div class="col-8">                        <div class="input-group">                            <input type="text" class="datepicker form-control text-20" placeholder="Sélectionnez..." id="date_bl" name="date_bl" value="<?php echo Outils::dateSqlToFr($bl->getDate()); ?>"/>                            <div class="input-group-append">                                <span class="input-group-text"><i class="far fa-calendar-alt gris-5 fa-lg"></i></span>                            </div>                        </div>                    </div>                </div>                <div class="row mb-1">                    <div class="col-4 padding-top-10">                        <span class="gris-7">Date livraison</span>                    </div>                    <div class="col-8">                        <div class="input-group">                            <input type="text" class="datepicker form-control text-20" placeholder="Sélectionnez..." id="date_livraison" name="date_livraison" value="<?php echo Outils::dateSqlToFr($bl->getDate_livraison()); ?>"/>                            <div class="input-group-append">                                <span class="input-group-text"><i class="far fa-calendar-alt gris-5 fa-lg"></i></span>                            </div>                        </div>                    </div>                </div>                <div class="row mb-1">                    <div class="col-4 padding-top-10">                        <span class="gris-7">Client facturé</span>                    </div>                    <div class="col-8">                        <select class="selectpicker form-control show-tick" data-live-search="true" data-live-search-placeholder="Rechercher" name="id_t_fact" title="Sélectionnez...">                            <?php                            foreach ($listeClients as $clt) { ?>                                <option value="<?php echo $clt->getId(); ?>" <?php echo $clt->getId() == $bl->getId_tiers_facturation() ? 'selected' : ''; ?>><?php echo $clt->getNom(); ?></option>                            <?php }                            ?>                        </select>                    </div>                </div>                <div class="row mb-1">                    <div class="col-4 padding-top-10">                        <span class="gris-7">Client livré</span>                    </div>                    <div class="col-8">                        <select class="selectpicker form-control show-tick" data-live-search="true" data-live-search-placeholder="Rechercher" name="id_t_livr" id="id_tiers_livraison" title="Sélectionnez (si différent)...">                            <?php                            foreach ($listeClients as $clt) { ?>                                <option value="<?php echo $clt->getId(); ?>" <?php echo $clt->getId() == $bl->getId_tiers_livraison() ? 'selected' : ''; ?>><?php echo $clt->getNom(); ?></option>                            <?php }                            ?>                        </select>                    </div>                </div>                <div class="row mb-1">                    <div class="col-4 padding-top-10">                        <span class="gris-7">Adresse</span>                    </div>                    <div class="col-8">                        <select class="selectpicker form-control show-tick" data-live-search="true" data-live-search-placeholder="Rechercher" name="id_adresse" id="selectAdresses">                        </select>                    </div>                </div>                <div class="row mb-1">                    <div class="col-4 padding-top-10">                        <span class="gris-7">Transporteur</span>                    </div>                    <div class="col-8">                        <select class="selectpicker form-control show-tick" name="id_transp" <?php                        echo count($transporteurs) > 1 ? 'title="Sélectionnez..."' : '' ?>>                            <?php                            foreach ($tiersManager->getListeTransporteurs() as $trans) { ?>                                <option value="<?php echo $trans->getId(); ?>" <?php echo $trans->getId() == $bl->getId_tiers_transporteur() ? 'selected' : ''; ?>><?php echo $trans->getNom(); ?></option>                            <?php }                            ?>                        </select>                    </div>                </div>                <div class="row mb-1 d-none">                    <div class="col-4 padding-top-10">                        <span class="gris-7">Chiffrage</span>                    </div>                    <div class="col-3">                        <select class="selectpicker form-control show-tick" name="chiffrage" id="chiffrage">                            <option value="1" <?php echo $bl->getChiffrage() == 1 ? 'selected' : ''; ?>>Chiffré</option>                            <option value="0" <?php echo $bl->getChiffrage() == 0 ? 'selected' : ''; ?>>Non chiffré</option>                        </select>                    </div>                </div>                <div class="row mb-3">                    <div class="col-4 padding-top-10">                        <span class="gris-7">Regroupement</span>                    </div>                    <div class="col-3">                        <select class="selectpicker form-control show-tick" name="regroupement" id="regroupement">                            <option value="0" <?php echo $bl->getRegroupement() == 0 ? 'selected' : ''; ?>>Non</option>                            <option value="1" <?php echo $bl->getRegroupement() == 1 ? 'selected' : ''; ?>>Oui</option>                        </select>                    </div>                </div>                <div class="row mt-2">                    <div class="col-4">                        <button type="button" class="btn btn-info form-control text-center btnBleuAjouterProduitBl">                            <i class="fa fa-fw fa-plus-circle mb-1"></i><br>Ajouter un produit                        </button>                    </div>                    <div class="col-4">                        <button type="button" class="btn btn-secondary form-control text-center" data-toggle="modal" data-target="#modalAddLigneBl">                            <i class="fa fa-fw fa-plus-circle mb-1"></i><br>Ligne simple                        </button>                    </div>                    <div class="col-4">                        <button type="button" class="btn btn-success form-control text-center" id="btnEnregistreBl">                            <i class="fa fa-fw fa-save mb-1"></i><br>Enregistrer le BL                        </button>                    </div>                </div>            </form>        </div>    </div></div><?phpinclude('includes/modales/modal_add_ligne_bl.php');include('includes/modales/modal_add_pdt_bl.php');include('includes/modales/modal_emballages_palette.php');include('includes/modales/modal_info.php');include('includes/footer.php');