<?php/*   _|_|_|  _|_|_|    _| _|        _|    _|  _|        CBO FrameWork _|        _|_|_|    _|        (c) 2018 Cédric Bouillon _|        _|    _|  _|   _|_|_|  _|_|_|    _|_|_|_|--------------------------------------------------------Contrôleur Ajax CLIENTS------------------------------------------------------*/ini_set('display_errors',1);error_reporting(0);// Évite les problèmes de génération de PDF suite à des Warning// Initialisation du mode d'appel$mode       = isset($_REQUEST['mode']) ? $_REQUEST['mode'] : '';// Intégration de la configuration du FrameWork et des autorisationsrequire_once '../php/config.php';// Instanciation des Managers$tiersManager = new TiersManager($cnx);$logsManager = new LogManager($cnx);$fonctionNom = 'mode'.ucfirst($mode);if (function_exists($fonctionNom)) {	$fonctionNom();}/* ------------------------------------MODE - Modale Adresses client (admin)------------------------------------*/function modeModalAdresses() {	global	    $utilisateur,	    $tiersManager,        $cnx;	// On vérifie qu'on est bien loggé	if (!isset($_SESSION['logged_user'])) { exit;}	$client_id = isset($_REQUEST['id']) ? intval($_REQUEST['id']) : 0;	if ($client_id == 0) { exit('ERREUR^Identification du client impossible !'); }	$client = $tiersManager->getTiers($client_id);	if (!$client instanceof Tiers) { exit('ERREUR^Instanciation du client impossible !'); }	// On instancie l'utilisateur en session s'il ne l'est pas déjà	if (!isset($utilisateur)) { $utilisateur = unserialize($_SESSION['logged_user']); }	$id_client_web = $tiersManager->getId_client_web();	$isClientWeb = $id_client_web == $client_id;	$paysManager = new PaysManager($cnx);	$id_adresse = isset($_REQUEST['id_adresse']) ? intval($_REQUEST['id_adresse']) : 0; // Pour édition d'une adresse	$adressesManager = new AdresseManager($cnx);	$adresseEdit = $id_adresse > 0 ? $adressesManager->getAdresse($id_adresse) : new Adresse([]);	if (!$adresseEdit instanceof Adresse) { $adresseEdit = new Adresse(); $id_adresse = 0;}	// Retour Titre	echo '<i class="fa fa-map-marker-alt"></i> Adresses de ' . $client->getNom();	// Séparateur Titre/Body pour le callback aJax	echo '^';	// Retour Body ?>    <div class="row">        <div class="col">            <?php            if (empty($client->getAdresses())) { ?>                <div class="alert alert-warning text-center padding-50">                    Aucune adresse pour ce client&hellip;                </div>            <?php } else { ?>                <table class="table admin table-v-middle table-fine">                    <thead>                    <tr>                        <th>Adresse</th>                        <th>Complément</th>                        <th>CP</th>                        <th>Ville</th>                        <th>Pays</th>                        <th>Type</th>                        <th class="t-actions w-mini-admin-cell text-center">Modif.</th>                        <th class="t-actions w-mini-admin-cell text-center <?php echo $isClientWeb ? 'd-none' : ''; ?>">Suppr.</th>                    </tr>                    </thead>                    <tbody>                    <?php                    foreach ($client->getAdresses() as $adresse) { ?>                        <tr data-id="<?php echo $adresse->getId(); ?>" data-id-client="<?php echo $adresse->getId_tiers(); ?>" <?php echo $id_adresse == $adresse->getId() ? 'class="bg-info text-white"' : ''; ?>>                            <td><?php echo $adresse->getAdresse_1();?></td>                            <td><?php echo $adresse->getAdresse_2() != '' ? $adresse->getAdresse_2() : '&mdash;';?></td>                            <td><?php echo $adresse->getCp();?></td>                            <td><?php echo $adresse->getVille();?></td>                            <td><?php echo $adresse->getNom_pays();?></td>                            <td><?php echo Adresse::TYPES[$adresse->getType()];?></td>                            <td class="<?php echo $id_adresse != $adresse->getId() ? 't-actions' : ''; ?> text-center">								<?php if ($id_adresse == $adresse->getId()) { ?>									<i class="fa fa-edit fa-lg"></i>								<?php } else { ?>									<button type="button" class="btn btn-sm btn-secondary btnEditAdresse"><i class="fa fa-edit"></i></button>								<?php } ?>							</td>                            <td class="<?php echo $id_adresse != $adresse->getId() ? 't-actions' : ''; ?> text-center <?php echo $isClientWeb ? 'd-none' : ''; ?>">								<?php if ($id_adresse == $adresse->getId()) { ?>									<i class="fa fa-arrow-right fa-lg"></i>								<?php } else { ?>									<button type="button" class="btn btn-sm btn-danger btnSupprAdresse"><i class="fa fa-trash-alt"></i></button>								<?php } ?>							</td>                        </tr>                    <?php }                    ?>                    </tbody>                </table>			<?php } ?>        </div>        <div class="col-4 <?php echo $isClientWeb && $id_adresse == 0 ? 'd-none' : ''; ?>">            <div class="alert alert-secondary">                <p class="nomargin gris-5"><i class="fa <?php echo $id_adresse == 0 ? 'fa-plus-square' : 'fa-edit'; ?> mr-1 gris-9"></i> <?php echo $id_adresse == 0 ? 'Nouvelle' : 'Modification'; ?> adresse client :</p>                <hr class="margin-5">                <form id="addUpdAdresseClt">                    <input type="hidden" name="mode" value="addUpdAdresse"/>                    <input type="hidden" name="id_adresse" value="<?php echo $id_adresse; ?>"/>                    <input type="hidden" name="id_client" value="<?php echo $client_id; ?>"/>                    <div class="row mb-2">                        <div class="col">                            <span class="texte-fin text-13">Nom :</span>                            <div class="input-group">                                <input type="text" class="form-control texte-fin text-13" placeholder="Raison sociale (si différente)" name="nom" maxlength="255" value="<?php echo $id_adresse > 0 ? $adresseEdit->getNom() : ''; ?>"/>                            </div>                        </div>                    </div>                    <div class="row mb-2">                        <div class="col">                            <span class="texte-fin text-13">Adresse :</span>                            <div class="input-group">                                <input type="text" class="form-control texte-fin text-13" placeholder="Numéro, voie..." name="adresse_1" maxlength="255" value="<?php echo $id_adresse > 0 ? $adresseEdit->getAdresse_1() : ''; ?>"/>                            </div>                        </div>                    </div>                    <div class="row mb-2">                        <div class="col">                            <span class="texte-fin text-13">Complément d'adresse :</span>                            <div class="input-group">                                <input type="text" class="form-control texte-fin text-13" placeholder="Bâtiement, étage..." name="adresse_2" maxlength="255" value="<?php echo $id_adresse > 0 ? $adresseEdit->getAdresse_2() : ''; ?>"/>                            </div>                        </div>                    </div>                    <div class="row mb-2">                        <div class="col-4">                            <span class="texte-fin text-13">Code postal :</span>                            <div class="input-group">                                <input type="text" class="form-control texte-fin text-13" placeholder="CP" name="cp" maxlength="10" value="<?php echo $id_adresse > 0 ? $adresseEdit->getCp() : ''; ?>"/>                            </div>                        </div>                        <div class="col-8">                            <span class="texte-fin text-13">Ville :</span>                            <div class="input-group">                                <input type="text" class="form-control texte-fin text-13" placeholder="Ville" name="ville" maxlength="255" value="<?php echo $id_adresse > 0 ? $adresseEdit->getVille() : ''; ?>"/>                            </div>                        </div>                    </div>                    <div class="row mb-4">                        <div class="col-7">                            <span class="texte-fin text-13">Pays:</span>                            <div class="input-group">                                <select class="selectpicker form-control show-tick" name="id_pays" data-size="5">                                    <?php                                    foreach ($paysManager->getListePays() as $pays) { ?>                                        <option value="<?php echo $pays->getId(); ?>" <?php										if ($id_adresse == 0) {											echo strtolower($pays->getIso()) == 'fr' ? 'selected' : '';										} else {										echo 	$adresseEdit->getId_pays() == $pays->getId() ? 'selected' : '';										} ?>><?php echo $pays->getNom();?></option>                                    <?php }                                    ?>                                </select>                            </div>                        </div>                        <div class="col-5">                            <span class="texte-fin text-13">Type :</span>                            <div class="input-group">								<input type="checkbox"									   name="type"									   class="togglemaster"									   data-toggle="toggle"									   data-on="Livraison"									   data-off="Facturation"									   data-onstyle="secondary"									   data-offstyle="secondary"										<?php echo $id_adresse > 0 && $adresseEdit->getType() == 1 ? 'checked' : ''; ?>								/>							</div>						</div>					</div>					<div class="row">                        <div class="col">                            <button type="button" class="btn btn-success form-control btnAddUpdAdresse">                                <i class="fa fa-check mr-1"></i> <?php echo $id_adresse > 0 ? 'Enregistrer' : 'Ajouter'; ?>                            </button>                        </div>                    </div>                </form>            </div>        </div>    </div>    <?php	exit;} // FIN mode/* ------------------------------------MODE - Modale Contacts client (admin)------------------------------------*/function modeModalContacts() {	global	$utilisateur,	$tiersManager,	$cnx;	// On vérifie qu'on est bien loggé	if (!isset($_SESSION['logged_user'])) { exit;}	$client_id = isset($_REQUEST['id']) ? intval($_REQUEST['id']) : 0;	if ($client_id == 0) { exit('ERREUR^Identification du client impossible !'); }	$client = $tiersManager->getTiers($client_id);	if (!$client instanceof Tiers) { exit('ERREUR^Instanciation du client impossible !'); }	// On instancie l'utilisateur en session s'il ne l'est pas déjà	if (!isset($utilisateur)) { $utilisateur = unserialize($_SESSION['logged_user']); }	$id_contact = isset($_REQUEST['id_contact']) ? intval($_REQUEST['id_contact']) : 0; // Pour édition d'un contact	$contactsManager = new ContactManager($cnx);	$contactEdit = $id_contact > 0 ? $contactsManager->getContact($id_contact) : new Contact([]);	if (!$contactEdit instanceof Contact) { $contactEdit = new Contact(); $id_contact = 0;}	// Retour Titre	echo '<i class="fa fa-user-friends"></i> Contacts de ' . $client->getNom();	// Séparateur Titre/Body pour le callback aJax	echo '^';	// Retour Body ?>    <div class="row">        <div class="col-8">			<?php			if (empty($client->getContacts())) { ?>                <div class="alert alert-warning text-center padding-50">                    Aucun contact pour ce client&hellip;                </div>			<?php } else { ?>                <table class="table admin table-v-middle table-fine">                    <thead>                    <tr>                        <th>Nom</th>                        <th>Télephone</th>                        <th>Mobile</th>                        <th>Fax</th>                        <th>E-mail</th>                        <th class="t-actions w-mini-admin-cell text-center">Modif.</th>                        <th class="t-actions w-mini-admin-cell text-center">Suppr.</th>                    </tr>                    </thead>                    <tbody>					<?php					foreach ($client->getContacts() as $contact) {					    $cssA = $id_contact == $contact->getId() ? 'text-white' : 'text-info';						?>                        <tr data-id="<?php echo $contact->getId(); ?>" data-id-client="<?php echo $contact->getId_tiers(); ?>" <?php echo $id_contact == $contact->getId() ? 'class="bg-info text-white"' : ''; ?>>                            <td><?php echo $contact->getNom_complet();?></td>                            <td><?php echo trim($contact->getTelephone()) != '' ? trim($contact->getTelephone()) : '&mdash;';?></td>                            <td><?php echo trim($contact->getMobile()) != '' ? trim($contact->getMobile()) : '&mdash;';?></td>                            <td><?php echo trim($contact->getFax()) != '' ? trim($contact->getFax()) : '&mdash;';?></td>                            <td><?php echo trim($contact->getEmail()) != ''                                    ? '<a href="mailto:'.trim($contact->getEmail()).'" class="texte-fin '.$cssA.'">'.trim($contact->getEmail()).'</a>'                                    : '&mdash;';?></td>                            <td class="<?php echo $id_contact != $contact->getId() ? 't-actions' : ''; ?> text-center">								<?php if ($id_contact == $contact->getId()) { ?>                                    <i class="fa fa-edit fa-lg"></i>								<?php } else { ?>                                    <button type="button" class="btn btn-sm btn-secondary btnEditContact"><i class="fa fa-edit"></i></button>								<?php } ?>                            </td>                            <td class="<?php echo $id_contact != $contact->getId() ? 't-actions' : ''; ?> text-center">								<?php if ($id_contact == $contact->getId()) { ?>                                    <i class="fa fa-arrow-right fa-lg"></i>								<?php } else { ?>                                    <button type="button" class="btn btn-sm btn-danger btnSupprContact"><i class="fa fa-trash-alt"></i></button>								<?php } ?>                            </td>                        </tr>					<?php }					?>                    </tbody>                </table>			<?php } ?>        </div>        <div class="col-4">            <div class="alert alert-secondary">                <p class="nomargin gris-5"><i class="fa <?php echo $id_contact == 0 ? 'fa-plus-square' : 'fa-edit'; ?> mr-1 gris-9"></i> <?php echo $id_contact == 0 ? 'Nouveau' : 'Modification'; ?> contact client :</p>                <hr class="margin-5">                <form id="addUpdContactClt">                    <input type="hidden" name="mode" value="addUpdContact"/>                    <input type="hidden" name="id_contact" value="<?php echo $id_contact; ?>"/>                    <input type="hidden" name="id_client" value="<?php echo $client_id; ?>"/>                    <div class="row mb-2">                        <div class="col-6">                            <span class="texte-fin text-13">Nom :</span>                            <div class="input-group">                                <input type="text" class="form-control texte-fin text-13" placeholder="Nom de famille" name="nom" maxlength="255" value="<?php echo $id_contact > 0 ? $contactEdit->getNom() : ''; ?>"/>                            </div>                        </div>                        <div class="col-6">                            <span class="texte-fin text-13">Prénom :</span>                            <div class="input-group">                                <input type="text" class="form-control texte-fin text-13" placeholder="Prénom" name="prenom" maxlength="255" value="<?php echo $id_contact > 0 ? $contactEdit->getPrenom() : ''; ?>"/>                            </div>                        </div>                    </div>                    <div class="row mb-2">                        <div class="col-6">                            <span class="texte-fin text-13">Téléphone :</span>                            <div class="input-group">                                <input type="text" class="form-control texte-fin text-13" placeholder="Numéro principal" name="telephone" maxlength="16" value="<?php echo $id_contact > 0 ? $contactEdit->getTelephone() : ''; ?>"/>                            </div>                        </div>                        <div class="col-6">                            <span class="texte-fin text-13">Mobile :</span>                            <div class="input-group">                                <input type="text" class="form-control texte-fin text-13" placeholder="Numéro portable" name="mobile" maxlength="16" value="<?php echo $id_contact > 0 ? $contactEdit->getMobile() : ''; ?>"/>                            </div>                        </div>                    </div>                    <div class="row mb-2">                        <div class="col-6">                            <span class="texte-fin text-13">Fax :</span>                            <div class="input-group">                                <input type="text" class="form-control texte-fin text-13" placeholder="Numéro de fax" name="fax" maxlength="16" value="<?php echo $id_contact > 0 ? $contactEdit->getFax() : ''; ?>"/>                            </div>                        </div>                    </div>                    <div class="row mb-4">                        <div class="col">                            <span class="texte-fin text-13">Adresse e-mail :</span>                            <div class="input-group">                                <input type="text" class="form-control texte-fin text-13" placeholder="exemple@domaine.com" name="email" maxlength="128" value="<?php echo $id_contact > 0 ? $contactEdit->getEmail() : ''; ?>"/>                            </div>                        </div>                    </div>                    <div class="row">                        <div class="col">                            <button type="button" class="btn btn-success form-control btnAddUpdContact">                                <i class="fa fa-check mr-1"></i> <?php echo $id_contact > 0 ? 'Enregistrer' : 'Ajouter'; ?>                            </button>                        </div>                    </div>                </form>            </div>        </div>    </div>	<?php	exit;} // FIN mode/* ------------------------------------MODE - Modale Client (admin)------------------------------------*/function modeModalClient() {    global	    $cnx,	    $utilisateur,	    $tiersManager;    // On vérifie qu'on est bien loggé    if (!isset($_SESSION['logged_user'])) { exit;}	$client_id = isset($_REQUEST['id']) ? intval($_REQUEST['id']) : 0;	$client    = $client_id > 0 ? $tiersManager->getTiers($client_id) : new Tiers([]);	// On instancie l'utilisateur en session s'il ne l'est pas déjà	if (!isset($utilisateur)) {		$utilisateur = unserialize($_SESSION['logged_user']);    }	// Si nouveau client, on crée un code comptable pour pré-remplir le champ en calculant le prochain dispo    if ($client->getId() == 0) {        $client->setCode_comptable($tiersManager->getNextCodeComptable());    }	$id_client_web = $tiersManager->getId_client_web();    $isClientWeb = $client->getId() == $id_client_web;	// Retour Titre	echo '<i class="fa fa-address-card"></i>';	echo $client_id > 0 ? $client->getNom() : "Nouveau client&hellip;";	// Séparateur Titre/Body pour le callback aJax	echo '^';	// Retour Body ?>	<form class="container-fluid" id="formClientAddUpd">        <input type="hidden" name="mode" value="saveClient"/>        <input type="hidden" name="client_id" id="input_id" value="<?php echo $client_id; ?>"/>		<div class="row"> <!-- Conteneur principal -->            <div class="col-7"> <!-- Bloc gauche -->                <div class="row"> <!-- Ligne 1 -->                    <div class="col-7 input-group mt-2">                        <div class="input-group-prepend">                            <span class="input-group-text">Nom</span>                        </div>                        <input type="text" class="form-control" placeholder="Nom ou raison sociale" name="nom" id="input_nom" value="<?php echo $client->getNom(); ?>">                        <div class="invalid-feedback">Le nom ou raison sociale est obligatoire.</div>                    </div>                    <div class="col-5 input-group mt-2">                        <div class="input-group-prepend">                            <span class="input-group-text">Code client</span>                        </div>                        <input type="text" class="form-control <?php echo $isClientWeb ? 'disabled' : ''; ?>" <?php echo $isClientWeb ? 'disabled' : ''; ?> placeholder="Code interne" name="code" id="code_client" value="<?php echo $client->getCode(); ?>">                    </div>                </div> <!-- FIN ligne 1 -->                <div class="row mt-3"> <!-- Ligne 2 -->                    <div class="col-6 input-group mt-2">                        <div class="input-group-prepend">                            <span class="input-group-text"><i class="fa fa-landmark gris-9"></i></span>                        </div>                        <input type="text" class="form-control" placeholder="TVA Intracommunaitaire" name="tva_intra" id="input_tva_intra" value="<?php echo $client->getTva_intra(); ?>">                    </div>                    <div class="col-6 mt-2 input-group">                        <div class="input-group-prepend">                            <span class="input-group-text text-12">Groupe</span>                        </div>                        <select class="form-control selectpicker show-tick" title="Aucun" name="id_groupe">							<?php							foreach ($tiersManager->getListeTiersGroupes() as $groupe) { ?>                                <option value="<?php echo $groupe->getID(); ?>" <?php echo $groupe->getId() == $client->getId_groupe() ? 'selected' : '';?>><?php echo $groupe->getNom(); ?></option>							<?php }	?>                        </select>                    </div>                </div> <!-- FIN ligne 2 -->                <div class="row mt-3"> <!-- Ligne 3 -->                    <div class="col-4 mt-2 input-group">                        <div class="input-group-prepend">                            <span class="input-group-text text-12">Palette suivante</span>                        </div>                        <input type="text" class="form-control text-center" readonly value="<?php echo $client->getPalette_suiv(); ?>"/>                        <div class="input-group-append">                            <button class="btn btn-secondary <?php							echo $client->getPalette_suiv() == 1 ? 'disabled' : 'btnResetPaletteSuiv'; ?>" <?php                            echo $client->getPalette_suiv() < 10 ? 'disabled' : ''; ?> type="button"><i class="fa fa-undo"></i></button>                        </div>                    </div>                    <div class="col-4 mt-2 input-group text-right">                        <div class="input-group-prepend">                            <span class="input-group-text text-12">Visibilité palettes</span>                        </div>                        <input type="checkbox" class="togglemaster form-control" data-toggle="toggle" name="visibilite_palettes"							<?php echo $client->getVisibilite_palettes() == 1 ? 'checked' : ''; ?>                               data-on="Oui"                               data-off="Non"                               data-onstyle="info"                               data-offstyle="secondary"                        />                    </div>                    <div class="col-2 text-right mt-2">                        <input type="checkbox" class="togglemaster <?php echo $isClientWeb ? 'disabled' : ''; ?>" data-toggle="toggle" name="activation"							<?php echo $client->isActif() ? 'checked' : ''; ?>							<?php echo $isClientWeb ? 'disabled' : ''; ?>                               data-on="Activé"                               data-off="Désactivé"                               data-onstyle="success"                               data-offstyle="danger"                        />                    </div>                </div> <!-- FIN ligne 3 -->				<?php				// Si nouveau client, on propose la création d'un premier contact + des adresses				if ($client_id == 0) { ?>                <div class="row mt-3">                    <div class="col">                        <div class="alert alert-secondary">                            <div class="row">                                <div class="col-12">                                    <p class="small mb-1"><i class="fa fa-map-marked-alt mr-1 gris-9"></i> Adresse de facturation</p><hr class="mt-0">                                </div>                                <div class="col-12 mb-2">                                    <input type="text" name="adr_fact_nom" class="form-control" placeholder="Raison sociale (si différente)" value=""/>                                </div>                                <div class="col-6 mb-2">                                    <input type="text" name="adr_fact_adresse_1" class="form-control" placeholder="Adresse" value=""/>                                </div>                                <div class="col-6 mb-2">                                    <input type="text" name="adr_fact_adresse_2" class="form-control" placeholder="Complément d'adresse" value=""/>                                </div>                                <div class="col-3 mb-2">                                    <input type="text" name="adr_fact_cp" class="form-control" placeholder="Code postal" value=""/>                                </div>                                <div class="col-5 mb-2">                                    <input type="text" name="adr_fact_ville" class="form-control" placeholder="Ville" value=""/>                                </div>                                <div class="col-4 mb-2">                                    <select class="selectpicker form-control" title="Pays" name="adr_fact_id_pays">                                        <?php                                        $paysManager = new PaysManager($cnx);                                        foreach ($paysManager->getListePays() as $pays) { ?>                                            <option value="<?php echo $pays->getId(); ?>"><?php echo $pays->getNom(); ?></option>                                        <?php } ?>                                    </select>                                </div>                                <div class="col-12 mb-2">                                    <input type="checkbox" class="icheck checkadresses" id="checkAdreLivr" checked value="1" name="livridem">                                    <label for="checkAdreLivr" class="texte-fin text-13 pointeur ml-1"> Adresse de livraison identique</label>                                </div>                            </div>                            <div class="row new-clt-zone-livraison d-none">                                <div class="col-12 mt-2">                                    <p class="small mb-1"><i class="fa fa-map-marked-alt mr-1 gris-9"></i> Adresse de livraison</p><hr class="mt-0">                                </div>                                <div class="col-12 mb-2">                                    <input type="text" name="adr_livr_nom" class="form-control" placeholder="Raison sociale (si différente)" value=""/>                                </div>                                <div class="col-6 mb-2">                                    <input type="text" name="adr_livr_adresse_1" class="form-control" placeholder="Adresse" value=""/>                                </div>                                <div class="col-6 mb-2">                                    <input type="text" name="adr_livr_adresse_2" class="form-control" placeholder="Complément d'adresse" value=""/>                                </div>                                <div class="col-3 mb-2">                                    <input type="text" name="adr_livr_cp" class="form-control" placeholder="Code postal" value=""/>                                </div>                                <div class="col-5 mb-2">                                    <input type="text" name="adr_livr_ville" class="form-control" placeholder="Ville" value=""/>                                </div>                                <div class="col-4 mb-2">                                    <select class="selectpicker form-control" title="Pays" name="adr_livr_id_pays">                                        <?php                                        $paysManager = new PaysManager($cnx);                                        foreach ($paysManager->getListePays() as $pays) { ?>                                            <option value="<?php echo $pays->getId(); ?>"><?php echo $pays->getNom(); ?></option>                                        <?php }                                        ?>                                        <option></option>                                    </select>                                </div>                            </div>                        </div>                    </div>                </div>		<?php } // FIN test nouveau client		?>            </div> <!-- FIN bloc gauche -->            <div class="col-5"> <!-- Bloc droit (gescom) -->                <div class="row"> <!-- Ligne conteneur-->                    <div class="col-12"> <!-- Colonne conteneur-->                        <div class="alert alert-secondary"> <!-- Alert -->                            <div class="row mt-2">                                <div class="col-6 mt-2 input-group">                                    <div class="input-group-prepend">                                        <span class="input-group-text text-12">Code comptable</span>                                    </div>                                    <input type="text" name="code_comptable" <?php echo $client_id > 0 ? 'readonly disabled' : ''; ?> class="form-control text-center <?php echo $client_id > 0 ? 'disabled' : ''; ?>" placeholder="Compta" value="<?php echo $client->getCode_comptable(); ?>"/>                                </div>                                <div class="col-6 mt-2 input-group">                                    <div class="input-group-prepend">                                        <span class="input-group-text text-12">Echéance</span>                                    </div>                                    <input type="text" name="echeance" class="form-control text-center" placeholder="0" value="<?php echo $client->getEcheance(); ?>"/>                                    <div class="input-group-append">                                        <span class="input-group-text text-12">jours</span>                                    </div>                                </div>                            </div>                            <div class="row mt-2">                                <div class="col-7 mt-2 input-group">                                    <div class="input-group-prepend">                                        <span class="input-group-text text-12">EAN client</span>                                    </div>                                    <input type="text" name="ean" class="form-control text-center" placeholder="EAN client" value="<?php echo $client->getEan(); ?>"/>                                </div>                                <div class="col-5 mt-2 input-group">                                    <div class="input-group-prepend">                                        <span class="input-group-text text-12">Soumis TVA</span>                                    </div>                                    <input type="checkbox" class="togglemaster form-control <?php echo $isClientWeb ? 'disabled' : ''; ?>" data-toggle="toggle" name="tva"										<?php echo $client->getTva() == 1 ? 'checked' : ''; ?>										<?php echo $isClientWeb ? 'disabled' : ''; ?>                                           data-on="Oui"                                           data-off="Non"                                           data-onstyle="info"                                           data-offstyle="secondary"                                    />                                </div>                            </div>                            <div class="row mt-2"> <!-- Ligne 1 -->                                <div class="col mt-2 input-group">                                    <div class="input-group-prepend">                                        <span class="input-group-text text-12">Transporteur par défaut</span>                                    </div>                                    <select class="form-control selectpicker show-tick" title="Aucun" name="id_transporteur">										<?php										foreach ($tiersManager->getListeTransporteurs() as $transporteur) { ?>                                            <option value="<?php echo $transporteur->getID(); ?>" <?php											echo $transporteur->getId() == $client->getId_transporteur() ? 'selected' : '';?>><?php echo $transporteur->getNom(); ?></option>										<?php }	?>                                    </select>                                </div>                            </div> <!-- FIN ligne 1 -->                            <div class="row mt-2 d-none"> <!-- Ligne 2 -->                                <div class="col-6 mt-2 input-group text-right">                                    <div class="input-group-prepend">                                        <span class="input-group-text text-12">Exemplaires BL</span>                                    </div>                                    <input type="text" name="nb_ex_bl" class="form-control text-center" placeholder="0" value="<?php echo $client->getNb_ex_bl(); ?>"/>                                </div>                                <div class="col-6 mt-2 input-group text-right">                                    <div class="input-group-prepend">                                        <span class="input-group-text text-12">Exemplaires facture</span>                                    </div>                                    <input type="text" name="nb_ex_fact" class="form-control text-center" placeholder="0" value="<?php echo $client->getNb_ex_fact(); ?>"/>                                </div>                            </div> <!-- FIN ligne 2 -->                            <div class="row mt-2"> <!-- Ligne 3 -->                                <div class="col mt-2 input-group text-right">                                    <div class="input-group-prepend">                                        <span class="input-group-text text-12">BL</span>                                    </div>                                    <input type="checkbox" class="togglemaster form-control" data-toggle="toggle" name="bl_chiffre"                                        <?php echo $client->getBl_chiffre() == 1 ? 'checked' : ''; ?>                                           data-on="Chiffré"                                           data-off="Non-chiffré"                                           data-onstyle="info"                                           data-offstyle="secondary"                                    />                                </div>                                <div class="col mt-2 input-group text-right">                                    <div class="input-group-prepend">                                        <span class="input-group-text text-12">Regroupement pdts</span>                                    </div>                                    <input type="checkbox" class="togglemaster form-control" data-toggle="toggle" name="regroupement"										<?php echo $client->getRegroupement() == 1 ? 'checked' : ''; ?>                                           data-on="Oui"                                           data-off="Non"                                           data-onstyle="info"                                           data-offstyle="secondary"                                    />                                </div>                            </div>                            <div class="row mt-2"> <!-- Ligne 3 -->                                <div class="col-7 mt-2 input-group text-right">                                    <div class="input-group-prepend">                                        <span class="input-group-text text-12">Type stock</span>                                    </div>                                    <select class="form-control selectpicker show-tick" title="Non" name="stk_type">                                        <option value="0" <?php echo $client->getStk_type() == 0 ? 'selected' : ''; ?>>Désactivé</option>                                        <option data-divider="true"></option>                                        <option value="1" <?php echo $client->getStk_type() == 1 ? 'selected' : ''; ?>>Client</option>                                        <option value="2" <?php echo $client->getStk_type() == 2 ? 'selected' : ''; ?>>Stock / Dépot</option>                                    </select>                                </div>                            </div> <!-- FIN ligne 3 -->                            <div class="row mt-2"> <!-- Ligne 4 -->                                <div class="col mt-2">                                    <textarea class="form-control no-resize" name="message" placeholder="Message fixe"><?php echo Outils::br2nl($client->getMessage()); ?></textarea>                                </div>                            </div> <!-- FIN ligne 4 -->                        </div> <!-- FIN alert -->                    </div> <!-- FIN colonne conteneur -->                </div> <!-- FIN ligne conteneur -->                <?php                // Si nouveau client, on propose la création d'un premier contact + des adresses                if ($client_id == 0) { ?>                    <div class="row mt-2">                        <div class="col">                            <div class="alert alert-secondary">                                <div class="row">                                    <div class="col-12">                                        <p class="small mb-1"><i class="fa fa-user mr-1 gris-9"></i> Contact</p><hr class="mt-0">                                    </div>                                    <div class="col-6 mb-2">                                        <input type="text" name="ctc_nom" class="form-control" placeholder="Nom" value=""/>                                    </div>                                    <div class="col-6 mb-2">                                        <input type="text" name="ctc_prenom" class="form-control" placeholder="Prénom" value=""/>                                    </div>                                    <div class="col-6 mb-2">                                        <input type="text" name="ctc_tel" class="form-control" placeholder="Téléphone" value=""/>                                    </div>                                    <div class="col-6 mb-2">                                        <input type="text" name="ctc_mobile" class="form-control" placeholder="Mobile" value=""/>                                    </div>                                    <div class="col-6 mb-2">                                        <input type="text" name="ctc_fax" class="form-control" placeholder="Fax" value=""/>                                    </div>                                    <div class="col-12 mb-2">                                        <input type="text" name="ctc_mail" class="form-control" placeholder="Adresse e-mail" value=""/>                                    </div>                                </div>                            </div>                        </div>                    </div>               <?php } ?>            </div> <!-- FIN bloc droit (gescom) -->		</div> <!-- FIN conteneur principal -->	</form>    <div class="row mt-2">        <div class="col doublon d-none">            <div class="alert alert-danger">                <i class="fa fa-exclamation-circle mr-1"></i> Un autre client porte déjà ce nom !            </div>        </div>    </div>	<?php	// Séparateur Body/Footer pour le callback aJax	echo '^';	// Retour boutons footer si client existant (bouton supprimer)    if ($client_id > 0 && !$isClientWeb) {	?>	    <button type="button" class="btn btn-danger btn-sm btnSupprimeClient">            <i class="fa fa-times fa-lg vmiddle mr-1"></i> Supprimer	    </button>	<?php    } // FIN test édition utilisateur existant	exit;} // FIN mode/* ------------------------------------MODE - Enregistre un client (add/upd)------------------------------------*/function modeSaveClient() {    global        $cnx,        $tiersManager;	// Vérification des données	$nom                    = isset($_REQUEST['nom'])                   ? strtoupper(trim($_REQUEST['nom']))    : '';	$client_id              = isset($_REQUEST['client_id'])             ? intval($_REQUEST['client_id'])        : 0;	$id_groupe              = isset($_REQUEST['id_groupe'])             ? intval($_REQUEST['id_groupe'])        : 0;	$id_transporteur        = isset($_REQUEST['id_transporteur'])       ? intval($_REQUEST['id_transporteur'])  : 0;	//$nb_ex_bl               = isset($_REQUEST['nb_ex_bl'])              ? intval($_REQUEST['nb_ex_bl'])         : 0;	$nb_ex_bl               = 1; // Demande client du 25/05/2020 - Ne veut finalement plus ce champ	//$nb_ex_fact             = isset($_REQUEST['nb_ex_fact'])            ? intval($_REQUEST['nb_ex_fact'])       : 0;	$nb_ex_fact             = 1; // Demande client du 25/05/2020 - Ne veut finalement plus ce champ	$visibilite_palettes    = isset($_REQUEST['visibilite_palettes'])   ? 1 : 0;	$activation             = isset($_REQUEST['activation'])            ? 1 : 0;	$bl_chiffre             = isset($_REQUEST['bl_chiffre'])            ? 1 : 0;	$tva                    = isset($_REQUEST['tva'])                   ? 1 : 0;	$regroupement           = isset($_REQUEST['regroupement'])          ? 1 : 0;	$tva_intra              = isset($_REQUEST['tva_intra'])             ? trim(strip_tags($_REQUEST['tva_intra']))  : '';	$code_comptable         = isset($_REQUEST['code_comptable'])        ? trim($_REQUEST['code_comptable'])         : '';	$ean                    = isset($_REQUEST['ean'])                   ? trim($_REQUEST['ean'])                    : '';	$message                = isset($_REQUEST['message'])               ? trim($_REQUEST['message'])                : '';	$code                   = isset($_REQUEST['code'])                  ? trim($_REQUEST['code'])                   : '';	if ($tva < 0) { $tva = 0; }	// Premier contact (création)	$ctc_nom      = isset($_REQUEST['ctc_nom'])         ? trim(strip_tags($_REQUEST['ctc_nom']))    : '';	$ctc_prenom   = isset($_REQUEST['ctc_prenom'])      ? trim(strip_tags($_REQUEST['ctc_prenom'])) : '';	$ctc_tel      = isset($_REQUEST['ctc_tel'])         ? trim(strip_tags($_REQUEST['ctc_tel']))    : '';	$ctc_fax      = isset($_REQUEST['ctc_fax'])         ? trim(strip_tags($_REQUEST['ctc_fax']))    : '';	$ctc_mobile   = isset($_REQUEST['ctc_mobile'])      ? trim(strip_tags($_REQUEST['ctc_mobile'])) : '';	$ctc_mail     = isset($_REQUEST['ctc_mail'])        ? trim(strip_tags($_REQUEST['ctc_mail']))   : '';	// Adresses (création)	$adr_fact_nom           = isset($_REQUEST['adr_fact_nom'])          ? trim($_REQUEST['adr_fact_nom'])       : '';	$adr_fact_adresse_1     = isset($_REQUEST['adr_fact_adresse_1'])    ? trim($_REQUEST['adr_fact_adresse_1']) : '';	$adr_fact_adresse_2     = isset($_REQUEST['adr_fact_adresse_2'])    ? trim($_REQUEST['adr_fact_adresse_2']) : '';	$adr_fact_cp            = isset($_REQUEST['adr_fact_cp'])           ? trim($_REQUEST['adr_fact_cp'])        : '';	$adr_fact_ville         = isset($_REQUEST['adr_fact_ville'])        ? trim($_REQUEST['adr_fact_ville'])     : '';	$adr_fact_id_pays       = isset($_REQUEST['adr_fact_id_pays'])      ? intval($_REQUEST['adr_fact_id_pays']) : 0;	$livridem               = isset($_REQUEST['livridem']);	$adr_livr_nom           = isset($_REQUEST['adr_livr_nom'])          ? trim($_REQUEST['adr_livr_nom'])       : '';	$adr_livr_adresse_1     = isset($_REQUEST['adr_livr_adresse_1'])    ? trim($_REQUEST['adr_livr_adresse_1']) : '';	$adr_livr_adresse_2     = isset($_REQUEST['adr_livr_adresse_2'])    ? trim($_REQUEST['adr_livr_adresse_2']) : '';	$adr_livr_cp            = isset($_REQUEST['adr_livr_cp'])           ? trim($_REQUEST['adr_livr_cp'])        : '';	$adr_livr_ville         = isset($_REQUEST['adr_livr_ville'])        ? trim($_REQUEST['adr_livr_ville'])     : '';	$adr_livr_id_pays       = isset($_REQUEST['adr_livr_id_pays'])      ? intval($_REQUEST['adr_livr_id_pays']) : 0;	$echeance               = isset($_REQUEST['echeance'])              ? intval($_REQUEST['echeance'])         : 0;	$stk_type               = isset($_REQUEST['stk_type'])              ? intval($_REQUEST['stk_type'])         : 0;	// On gère le "+" qui ne passe pas en ajax et qui a été remplaçé par un #	$ctc_fax        = str_replace('#', '+', $ctc_fax);	$ctc_tel        = str_replace('#', '+', $ctc_tel);	$ctc_mobile     = str_replace('#', '+', $ctc_mobile);	$message        = str_replace('#', '+', $message);	// Si pas de prénom, de nom, de profil ou de code, on ne vas pas plus loin...	if ($nom == '') {		echo '-1';		exit;	} // FIN test champs requis    // Si on désactive, on retire la visibilité palette    if ($activation == 0) {		$visibilite_palettes = 0;    }	$id_client_web = $tiersManager->getId_client_web();	// Instanciation de l'objet CLIENT (hydraté ou vide)	$tiers = $client_id > 0 ? $tiersManager->getTiers($client_id) : new Tiers([]);	// On force les valeurs désactivées en UX pour le client web	if ($id_client_web == $client_id && $client_id > 0) {		$activation = 1;		$code = 'WEB';		$tva = 1;    }	// mise à jour des champs de base	$tiers->setNom($nom);	$tiers->setDate_maj(date('Y-m-d H:i:s'));	$tiers->setActif($activation);	$tiers->setId_groupe($id_groupe);	$tiers->setType(1); // Type de tiers = client	$tiers->setTva($tva);	$tiers->setEan($ean);	$tiers->setEcheance($echeance);	$tiers->setRegroupement($regroupement);    $tiers->setCode($code);	$tiers->setId_transporteur($id_transporteur);	$tiers->setNb_ex_bl($nb_ex_bl);	$tiers->setNb_ex_fact($nb_ex_fact);	$tiers->setBl_chiffre($bl_chiffre);    if ($code_comptable != '') {		$tiers->setCode_comptable($code_comptable);    }	$tiers->setMessage($message);	$tiers->setStk_type($stk_type);	$tiers->setTva_intra($tva_intra);	$tiers->setVisibilite_palettes($visibilite_palettes);	// Si création, on enregistre la date	if ($client_id == 0) {		$tiers->setDate_add(date('Y-m-d H:i:s'));	}    // Enregistrement et retour pour callBack ajax    $retour = $tiersManager->saveTiers($tiers);	$logsManager = new LogManager($cnx);	// Si création du premier contact et des adresses (nouveau client)    if (intval($retour) > 1 && $client_id == 0) {        // SI contact        if ($ctc_nom != '' || $ctc_prenom != '') {            $ctc = new Contact([]);            $ctc->setSupprime(0);            $ctc->setId_tiers(intval($retour));			$ctc->setNom($ctc_nom);			$ctc->setPrenom($ctc_prenom);			$ctc->setTelephone($ctc_tel);			$ctc->setMobile($ctc_mobile);			$ctc->setFax($ctc_fax);			$ctc->setEmail($ctc_mail);			$ctc->setDate_add(date('y-m-d h:i:s'));			$contactsManager = new ContactManager($cnx);			$retour_ctc = $contactsManager->saveContact($ctc);			$logCtc = new Log([]);			$logCtc_type = $retour_ctc ? 'info' : 'danger';			$logCtc_texte = $retour_ctc ? 'Création du premier contact du client #'.intval($retour) : 'ERREUR lors de la création du premier contact du nouveau client '.$tiers->getNom();			$logCtc->setLog_type($logCtc_type);			$logCtc->setLog_texte($logCtc_texte);			$logsManager->saveLog($logCtc);        } // FIN test contact        // Si adresse de livraison        if ($adr_fact_adresse_1 != '') {            $adressesManager = new AdresseManager($cnx);            $adresse_fact = new Adresse([]);			$adresse_fact->setId_tiers(intval($retour));			$adresse_fact->setNom($adr_fact_nom);			$adresse_fact->setSupprime(0);			$adresse_fact->setAdresse_1($adr_fact_adresse_1);			$adresse_fact->setAdresse_2($adr_fact_adresse_2);			$adresse_fact->setCp($adr_fact_cp);			$adresse_fact->setVille($adr_fact_ville);			$adresse_fact->setId_pays($adr_fact_id_pays);			$adresse_fact->setType(0);			$retour_adr_fact = $adressesManager->saveAdresse($adresse_fact);			$logAdrFact = new Log([]);			$logAdrFact_type = $retour_adr_fact ? 'info' : 'danger';			$logAdrFact_texte = $retour_adr_fact                ? 'Création de la première adresse de facturation du client #'.intval($retour)                : 'ERREUR lors de la création de la première adresse de facturation du nouveau client '.$tiers->getNom();			$logAdrFact->setLog_type($logAdrFact_type);			$logAdrFact->setLog_texte($logAdrFact_texte);			$logsManager->saveLog($logAdrFact);			// Si on a une adresse de livraison distincte			if ($adr_livr_adresse_1 != '' && $adr_fact_adresse_1 != $adr_livr_adresse_1) {				$adresse_livr = new Adresse([]);				$adresse_livr->setId_tiers(intval($retour));				$adresse_livr->setNom($adr_livr_nom);				$adresse_livr->setSupprime(0);				$adresse_livr->setAdresse_1($adr_livr_adresse_1);				$adresse_livr->setAdresse_2($adr_livr_adresse_2);				$adresse_livr->setCp($adr_livr_cp);				$adresse_livr->setVille($adr_livr_ville);				$adresse_livr->setId_pays($adr_livr_id_pays);				$adresse_livr->setType(1);				$retour_adr_livr = $adressesManager->saveAdresse($adresse_livr);				$logAdrLivr = new Log([]);				$logAdrLivr_type = $retour_adr_livr ? 'info' : 'danger';				$logAdrLivr_texte = $retour_adr_livr					? 'Création de la première adresse de livraison du client #' . intval($retour)					: 'ERREUR lors de la création de la première adresse de livraison du nouveau client ' . $tiers->getNom();				$logAdrLivr->setLog_type($logAdrLivr_type);				$logAdrLivr->setLog_texte($logAdrLivr_texte);				$logsManager->saveLog($logAdrLivr);			// SInon on crée une adresse de livraison identique à la facturation			} else if ($livridem) {				$adresse_livr = clone $adresse_fact;				$adresse_livr->setType(1);				$adresse_livr->setId(0);				$retour_adr_livr = $adressesManager->saveAdresse($adresse_livr);				$logAdrLivr = new Log([]);				$logAdrLivr_type = $retour_adr_livr ? 'info' : 'danger';				$logAdrLivr_texte = $retour_adr_livr					? 'Création de la première adresse de livraison du client #' . intval($retour)					: 'ERREUR lors de la création de la première adresse de livraison du nouveau client ' . $tiers->getNom();				$logAdrLivr->setLog_type($logAdrLivr_type);				$logAdrLivr->setLog_texte($logAdrLivr_texte);				$logsManager->saveLog($logAdrLivr);            } // FIN text livraison différente        } // FIN test adresse    } // FIN test création nouveau client    $log = new Log([]);    if ($retour) {		$log->setLog_type('info');		if ($client_id == 0) {		    $log->setLog_texte("Création d'un nouvel client : " . $tiers->getNom());        } else {			$log->setLog_texte("Mise à jour des informations du tiers (client) #" . (int)$client_id);        }    } else {		$log->setLog_type('danger');		if ($client_id == 0) {			$log->setLog_texte("ERREUR lors de la création d'un nouvel client : " . $nom);		} else {			$log->setLog_texte("ERREUR lors de la mise à jour des informations de tiers (client) #" . (int)$client_id);		}    } // FIN test retour création/maj pour log	$logsManager->saveLog($log);	echo $retour !== false ? '1' : '0';	exit;} // FIN mode/* ------------------------------------MODE - Affiche la liste des clients------------------------------------*/function modeShowListeClients() {    global	    $mode,		$utilisateur,        $tiersManager;	// Préparation pagination (Ajax)	$nbResultPpage      = 15;	$page               = isset($_REQUEST['page']) ? intval($_REQUEST['page']) : 1;	$filtresPagination  = '?mode='.$mode;	$start              = ($page-1) * $nbResultPpage;	$params['start'] 			= $start;	$params['nb_result_page'] 	= $nbResultPpage;	$params['show_inactifs'] 	= true;	$filtre_recherche   =  isset($_REQUEST['filtre_recherche'])  ? trim($_REQUEST['filtre_recherche'])   : '';	$filtre_pays        =  isset($_REQUEST['filtre_pays'])       ? intval($_REQUEST['filtre_pays'])      : 0;	$filtre_groupe      =  isset($_REQUEST['filtre_groupe'])     ? intval($_REQUEST['filtre_groupe'])     : 0;	$filtre_actif       =  isset($_REQUEST['filtre_actif']) && $_REQUEST['filtre_actif'] != ''     ? intval($_REQUEST['filtre_actif'])     : -1;	$filtre_type       =  isset($_REQUEST['filtre_type'])   ? intval($_REQUEST['filtre_type'])     : 0;	if ($filtre_recherche != '' ) { $params['recherche'] = $filtre_recherche;   $filtresPagination.= '&filtre_recherche='.$filtre_recherche; }	if ($filtre_pays      > 0 )   { $params['id_pays'] 	 = $filtre_pays;        $filtresPagination.= '&filtre_pays='.$filtre_pays;           }	if ($filtre_groupe    > 0 )   { $params['id_groupe'] = $filtre_groupe;      $filtresPagination.= '&filtre_groupe='.$filtre_groupe;       }	if ($filtre_actif     > -1  ) { $params['actif'] 	 = $filtre_actif;       $filtresPagination.= '&filtre_actif='.$filtre_actif;         }	if ($filtre_type     > -1  )  { $params['cltstock']  = $filtre_type;        $filtresPagination.= '&filtre_type='.$filtre_type;           }	$orderby_champ = isset($_REQUEST['orderby_champ']) ? $_REQUEST['orderby_champ'] : 'nom';	$orderby_sens = isset($_REQUEST['orderby_sens']) ? $_REQUEST['orderby_sens'] : 'ASC';	$params['orderby_champ']    = $orderby_champ;	$params['orderby_sens']    = $orderby_sens;	$listeClients = $tiersManager->getListeClients($params);	// Si aucun client a afficher	if (empty($listeClients)) { ?>        <div class="alert alert-danger">            <i class="fa fa-times-circle text-28 vmiddle mr-1"></i> <strong>Aucun client !</strong>        </div>    <?php	// Sinon, affichage de la liste des clients	} else {		$id_client_web = $tiersManager->getId_client_web();		// Liste non vide, construction de la pagination...		$nbResults  = $tiersManager->getNb_results();		$pagination = new Pagination($page);		$pagination->setUrl($filtresPagination);		$pagination->setNb_results($nbResults);		$pagination->setAjax_function(true);		$pagination->setNb_results_page($nbResultPpage);		$pagination->setNb_apres(2);		$pagination->setNb_avant(2);	    ?>        <div class="alert alert-danger d-md-none text-center">            <i class="fa fa-exclamation-circle text-28 mb-1"></i> <p>Connectez-vous depuis un apareil permettant un affichage plus large pour afficher cet écran&hellip;</p>        </div>        <table class="admin w-100 d-none d-md-table">            <thead>                <tr>				    <?php                    // On affiche l'ID que si on est développeur                    if ($utilisateur->isDev()) { ?><th class="w-court-admin-cell d-none d-xl-table-cell">ID</th><?php } ?>                    <th class="orderby pointeur w-mini-admin-cell d-none d-lg-table-cell" data-champ="t.`code`">Code <i class="ml-1 fa fa-sort gris-9"></i></th>                    <th class="orderby pointeur" data-champ="t.`nom`">Nom <i class="ml-1 fa fa-sort gris-9"></i></th>                    <th>Pays</th>                    <th>Contact</th>                    <th class="text-center w-court-admin-cell nowrap">Palette suiv.</th>                    <th class="text-center w-court-admin-cell">Visib. palettes</th>                    <th class="text-center w-court-admin-cell">Actif</th>					<th class="t-actions w-mini-admin-cell">Adresses</th>					<th class="t-actions w-mini-admin-cell">Contacts</th>					<th class="t-actions w-mini-admin-cell">Détails</th>                    <th class="t-actions w-mini-admin-cell">Tarifs</th>                </tr>            </thead>            <tbody>			    <?php                // Boucle sur les clients				foreach ($listeClients as $client) {					?>                    <tr>						<?php						// On affiche l'ID que si on est développeur                        if ($utilisateur->isDev()) { ?>                            <td class="w-court-admin-cell d-none d-xl-table-cell"><span class="badge badge-pill badge-warning"><?php echo $client->getId();?></span></td>                        <?php } ?>                        <td class="text-18"><?php echo $client->getCode() != '' ? $client->getCode() : '<span class="gris-9">&mdash;</span>';?></td>                        <td class="text-18"><?php echo $client->getNom() != '' ? $client->getNom() : '&mdash;';							if ($client->getNom_groupe() != '') { ?>                                <div class="texte-fin gris-7 text-13 margin-top--5"><?php echo $client->getNom_groupe(); ?></div>							<?php } ?></td>                        <td><?php echo $client->getPays() != '' ? $client->getPays('<br>') : '&mdash;'; ?></td>                        <td><?php echo $client->getContact() != '' ? $client->getContact('<br>') : '&mdash;';?></td>                        <td class="text-center w-court-admin-cell"><?php echo $client->getPalette_suiv(); ?></td>                        <td class="text-center w-court-admin-cell"><i class="fa fa-fw fa-lg fa-<?php echo $client->getVisibilite_palettes() == 1 ?  'eye text-info' : 'eye-slash text-secondary'; ?>"></i></td>                        <td class="text-center w-court-admin-cell"><i class="fa fa-fw fa-lg fa-<?php echo $client->isActif() ? 'check-circle text-success' : 'times-circle text-danger'; ?>"></i></td>						<td class="t-actions w-mini-admin-cell"><button type="button" class="btn btn-sm btn-outline-secondary" data-toggle="modal" data-target="#modalAdresses" data-client-id="<?php							echo $client->getId(); ?>"><i class="fa fa-map-marker-alt fa-fw"></i> </button></td>						<td class="t-actions w-mini-admin-cell"><button type="button" class="btn btn-sm btn-outline-secondary <?php echo $id_client_web == $client->getId() ? 'd-none' : ''; ?>" data-toggle="modal" data-target="#modalContacts" data-client-id="<?php							echo $client->getId(); ?>"><i class="fa fa-user-friends fa-fw"></i> </button><?php echo $id_client_web == $client->getId() ? '&mdash;' : ''; ?></td>                        <td class="t-actions w-mini-admin-cell">                            <?php if ($client->getCode() == 'WEB') { ?>                            <button type="button" class="btn btn-sm btn-secondary disabled" disabled data-client-id="<?php							echo $client->getId(); ?>"><i class="fa fa-ban"></i> </button>							<?php } else { ?>                            <button type="button" class="btn btn-sm btn-secondary" data-toggle="modal" data-target="#modalClient" data-client-id="<?php                            echo $client->getId(); ?>"><i class="fa fa-edit fa-fw"></i> </button>                            <?php } ?>                        </td>                        <td class="t-actions w-mini-admin-cell">                            <a href="<?php echo __CBO_ROOT_URL__.'gc-tarifs-clt.php?c='.base64_encode($client->getId());?>" class="btn btn-sm btn-info <?php echo $id_client_web == $client->getId() ? 'd-none' : ''; ?>"><i class="fa fa-calculator fa-fw"></i></a>							<?php echo $id_client_web == $client->getId() ? '&mdash;' : ''; ?>                        </td>                        </tr>                <?php				} // FIN boucle clients ?>            </tbody>        </table>	<?php		// Pagination (aJax)		if (isset($pagination)) {			// Pagination bas de page, verbose...			$pagination->setVerbose_pagination(1);			$pagination->setVerbose_position('right');			$pagination->setNature_resultats('client');			$pagination->setNb_apres(2);			$pagination->setNb_avant(2);			echo ($pagination->getPaginationHtml());		} // FIN test pagination	} // FIN test clients à afficher    exit;} // FIN mode/* ---------------------------------------MODE - Supprime un client---------------------------------------*/function modeSupprClient() {    global        $tiersManager,        $logsManager;    //  -> On ne supprime pas réellement pour les raisons de traçabilité, on passe le champ "supprime" à 1    // On récupère l'ID de l'client, si il n'est pas clairement identifié, on ne va pas plus loin    $id_client = isset($_REQUEST['id_client']) ? intval($_REQUEST['id_client']) : 0;    if ($id_client == 0) { exit; }    // Instanciation de l'objet Client    $client = $tiersManager->getTiers($id_client);    // On passe le statut à supprimé	$client->setSupprime(1);    // On désactive	$client->setActif(0);    // On enregistre la date de modification	$client->setDate_maj(date('Y-m-d H:i:s'));	// Si la mise à jour s'est bien passé en BDD    if ($tiersManager->saveTiers($client)) {        // On sauvegarde dans les LOGS        $log = new Log([]);        $log->setLog_texte("Suppression d'un client (champ 'supprime' à 1) : ID #" . $id_client);        $log->setLog_type('warning');		$logsManager->saveLog($log);    } // FIN test suppression OK pour Log    exit;} // FIN mode/* ------------------------------------------MODE - Vérifie si existe déjà (admin/modale)-------------------------------------------*/function modeCheckExisteDeja() {    global $tiersManager;    $id     = isset($_REQUEST['id'])        ? (int)$_REQUEST['id']      : 0;    $nom    = isset($_REQUEST['nom'])       ? trim($_REQUEST['nom'])    : '';	echo $tiersManager->checkExisteDeja($nom, $id) ? 1 : 0;} // FIN mode/* ------------------------------------------MODE - Export en PDF-------------------------------------------*/function modeExportPdf() {    global $tiersManager;	require_once(__CBO_ROOT_PATH__.'/vendor/html2pdf/html2pdf.class.php');	ob_start();	$content = genereContenuPdf();	$content .= ob_get_clean();	// On supprime tous les fichiers du même genre sur le serveur	foreach (glob(__CBO_ROOT_PATH__.'/temp/iprexclts-*.pdf') as $fichier) {		unlink($fichier);	}	try {		$nom_fichier = 'iprexclts-'.date('is').'.pdf';		$html2pdf = new HTML2PDF('P', 'A4', 'fr', false, 'ISO-8859-15');		$html2pdf->pdf->SetAutoPageBreak(false, 0);		$html2pdf->setDefaultFont('helvetica');		$html2pdf->writeHTML(utf8_decode($content));;		$savefilepath = __CBO_ROOT_PATH__.'/temp/'.$nom_fichier;		$html2pdf->Output($savefilepath, 'F');		echo __CBO_TEMP_URL__.$nom_fichier;	}	catch(HTML2PDF_exception $e) {		exit;	}	exit;} // FIN mode/* ----------------------------------------------------------------------------FONCTION DEPORTEE - Génère le contenu HTML pour le PDF-----------------------------------------------------------------------------*/function genereContenuPdf() {	global $cnx, $tiersManager;	// HEAD	$contenu = '<!DOCTYPE html><html><head>  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>  <style type="text/css">      * { margin:0; padding: 0; }      .header { border-bottom: 2px solid #ccc; }    .header img.logo { width: 200px; }    .text-right { text-align: right; }    .text-center { text-align: center; }    .table { border-collapse: collapse; }    .table-donnees th { font-size: 11px; }    .table-liste th { font-size: 9px; background-color: #d5d5d5; padding:3px; }    .table-liste td { font-size: 9px; padding-top: 3px; padding-bottom: 3px; border-bottom: 1px solid #ccc;}    .table-liste td.no-bb { border-bottom: none; padding-bottom: 0px; }    .titre {       background-color: teal;       color: #fff;       padding: 3px;       text-align: center;       font-weight: normal;       font-size: 14px;    }    .recap {       background-color: #ccc;       padding: 3px;       text-align: center;       font-weight: normal;       font-size: 10px;    }        .w100 { width: 100%; }    .w75 { width: 75%; }    .w50 { width: 50%; }    .w40 { width: 40%; }    .w25 { width: 25%; }    .w33 { width: 33%; }    .w34 { width: 34%; }    .w20 { width: 20%; }    .w30 { width: 30%; }    .w15 { width: 15%; }    .w35 { width: 35%; }    .w5 { width: 5%; }    .w10 { width: 10%; }    .w15 { width: 15%; }        .text-6 { font-size: 6px; }    .text-7 { font-size: 7px; }    .text-8 { font-size: 8px; }    .text-9 { font-size: 9px; }    .text-10 { font-size: 10px; }    .text-11 { font-size: 11px; }    .text-12 { font-size: 12px; }    .text-14 { font-size: 14px; }    .text-16 { font-size: 16px; }    .text-18 { font-size: 18px; }    .text-20 { font-size: 20px; }        .gris-3 { color:#333; }    .gris-5 { color:#555; }    .gris-7 { color:#777; }    .gris-9 { color:#999; }    .gris-c { color:#ccc; }    .gris-d { color:#d5d5d5; }    .gris-e { color:#e5e5e5; }        .mt-0 { margin-top: 0px; }    .mt-2 { margin-top: 2px; }    .mt-5 { margin-top: 5px; }    .mt-10 { margin-top: 10px; }    .mt-15 { margin-top: 15px; }    .mt-20 { margin-top: 20px; }    .mt-25 { margin-top: 25px; }    .mt-50 { margin-top: 50px; }        .mb-0 { margin-bottom: 0px; }    .mb-2 { margin-bottom: 2px; }    .mb-5 { margin-bottom: 5px; }    .mb-10 { margin-bottom: 10px; }    .mb-15 { margin-bottom: 15px; }    .mb-20 { margin-bottom: 20px; }    .mb-25 { margin-bottom: 25px; }    .mb-50 { margin-bottom: 50px; }        .mr-0 { margin-right: 0px; }    .mr-2 { margin-right: 2px; }    .mr-5 { margin-right: 5px; }    .mr-10 { margin-right: 10px; }    .mr-15 { margin-right: 15px; }    .mr-20 { margin-right: 20px; }    .mr-25 { margin-right: 25px; }    .mr-50 { margin-right: 50px; }        .ml-0 { margin-left: 0px; }    .ml-2 { margin-left: 2px; }    .ml-5 { margin-left: 5px; }    .ml-10 { margin-left: 10px; }    .ml-15 { margin-left: 15px; }    .ml-20 { margin-left: 20px; }    .ml-25 { margin-left: 25px; }    .ml-50 { margin-left: 50px; }        .pt-0 { padding-top: 0px; }    .pt-2 { padding-top: 2px; }    .pt-5 { padding-top: 5px; }    .pt-10 { padding-top: 10px; }    .pt-15 { padding-top: 15px; }    .pt-20 { padding-top: 20px; }    .pt-25 { padding-top: 25px; }    .pt-50 { padding-top: 50px; }        .pb-0 { padding-bottom: 0px; }    .pb-2 { padding-bottom: 2px; }    .pb-5 { padding-bottom: 5px; }    .pb-10 { padding-bottom: 10px; }    .pb-15 { padding-bottom: 15px; }    .pb-20 { padding-bottom: 20px; }    .pb-25 { padding-bottom: 25px; }    .pb-50 { padding-bottom: 50px; }        .pr-0 { padding-right: 0px; }    .pr-2 { padding-right: 2px; }    .pr-5 { padding-right: 5px; }    .pr-10 { padding-right: 10px; }    .pr-15 { padding-right: 15px; }    .pr-20 { padding-right: 20px; }    .pr-25 { padding-right: 25px; }    .pr-50 { padding-right: 50px; }        .pl-0 { padding-left: 0px; }    .pl-2 { padding-left: 2px; }    .pl-5 { padding-left: 5px; }    .pl-10 { padding-left: 10px; }    .pl-15 { padding-left: 15px; }    .pl-20 { padding-left: 20px; }    .pl-25 { padding-left: 25px; }    .pl-50 { padding-left: 50px; }        .text-danger { color: #d9534f; }      </style> </head><body>';	$contenu.=  genereEntetePagePdf();	// PAGE 1	// GENERAL	// Préparation des variables	$na             = '<span class="gris-9 text-11"><i>Non renseigné</i></span>';	$tiret          = '<span class="gris-9 text-11"><i>-</i></span>';	// Préparation des variables	$params = [];	$liste = $tiersManager->getListeClients($params);	$adressesManager = new AdresseManager($cnx);	$contactsManager = new ContactManager($cnx);	// Génération du contenu HTML	$contenu.= '<table class="table table-liste w100 mt-10">';	// Aucune client	if (empty($liste)) {		$contenu.= '<tr><td class="w100 text-center gris-9 text-11"><i>Aucun client</i></td></tr>';	// Liste des clients	} else {		foreach ($liste as $item) {			$actif        = $item->getActif() > 0 ? '' : ' (Désactivé)';			$contenu.= '<tr>                            <th class="w100">' . $item->getNom() . $actif.'</th>                        </tr>';			// On intègre les adresses            $adressesClient = $adressesManager->getListeAdresses(['id_tiers' => $item->getID()]);            foreach ($adressesClient as $adresse) {				$contenu.= '<tr>                                <td class="w100">';				$contenu.= count($adressesClient) > 1 ? Adresse::TYPES[$adresse->getType()] . ' : ' : 'Adresse : ';				$contenu.= $adresse->getNom() != '' ? $adresse->getNom() . ' ' : '';				$contenu.= $adresse->getAdresse_ligne();				$contenu.= '</td></tr>';            }			// On intègre les contacts            $contactsClient = $contactsManager->getListeContacts(['id_tiers' => $item->getId()]);			foreach ($contactsClient as $contact) {				$contenu.= '<tr>                                <td class="w100">';				$contenu.= trim($contact->getNom_complet()) != '-' ? $contact->getNom_complet() : '';				$contenu.= $contact->getTelephone() != '' ? ' Tél : ' . $contact->getTelephone() . ' ' : '';				$contenu.= $contact->getMobile() != '' ? ' Mobile : ' . $contact->getMobile() . ' ' : '';				$contenu.= $contact->getFax() != '' ? ' Fax : ' . $contact->getFax() . ' ' : '';				$contenu.= $contact->getEmail() != '' ? ' ' . $contact->getEmail() . ' ' : '';				$contenu.= '</td></tr>';			}		} // FIN boucle sur les produits	} // FIN test produits	$contenu.= '</table>';	$contenu.= '<table class="table w100 mt-15"><tr><th class="w100 recap">Nombre de clients : '. count($liste) .'</th></tr></table>';	// FOOTER	$contenu.= '<table class="w100 gris-9">                    <tr>                        <td class="w50 text-8">Document édité le '.date('d/m/Y').' à '.date('H:i:s').'</td>                        <td class="w50 text-right text-6">&copy; 2019 IPREX / INTERSED </td>                    </tr>                </table>            </body>        </html>';	// RETOUR CONTENU	return $contenu;} // FIN fonction déportée/* ----------------------------------------------------------------------------FONCTION DEPORTEE - Génère le header du PDF (logo...)-----------------------------------------------------------------------------*/function genereEntetePagePdf() {	global $cnx;	$entete = '<div class="header">                <table class="table w100">                    <tr>                        <td class="w33"><img src="'.__CBO_ROOT_URL__.'img/logo-pe-350.jpg" alt="PROFIL EXPORT" class="logo"/></td>                        <td class="w34 text-center pt-10">                            Liste des clients au '.date("d/m/Y").'                        </td>                        <td class="w33 text-right text-14">                            <p class="text-18"><b>IPREX</b></p>                            <p class="text-12 gris-7">Intranet PROFIL EXPORT</p>                        </td>                    </tr>                                </table>               </div>';	return $entete;} // FIN fonction déportée/* -------------------------------------------------MODE - Réinitalise la palette suivante à 1--------------------------------------------------*/function modeRazPaletteSuiv() {	global $tiersManager, $logsManager;	$id_client = isset($_REQUEST['id_client']) ? intval($_REQUEST['id_client']) : 0;	if ($id_client == 0) { exit; }	$client = $tiersManager->getTiers($id_client);	if (!$client instanceof Tiers) { exit; }	$client->setPalette_suiv(1);	if (!$tiersManager->saveTiers($client)) { exit; }	$log = new Log([]);	$log->setLog_type('info');	$log->setLog_texte("Réinitialisation du prochain numéro de palette à 1 pour le tiers ID " . $id_client);	$logsManager->saveLog($log);	echo '1';	exit;} // FIN mode/* -------------------------------------------------MODE - Enregistre un contact (add/upd)--------------------------------------------------*/function modeAddUpdContact() {	global $cnx, $logsManager;	$contactManager = new ContactManager($cnx);	$id_contact = isset($_REQUEST['id_contact'])    ? intval($_REQUEST['id_contact'])   : 0;	$id_client  = isset($_REQUEST['id_client'])     ? intval($_REQUEST['id_client'])    : 0;	$nom        = isset($_REQUEST['nom'])           ? trim($_REQUEST['nom'])            : '';	$prenom     = isset($_REQUEST['prenom'])        ? trim($_REQUEST['prenom'])         : '';	$telephone  = isset($_REQUEST['telephone'])     ? trim($_REQUEST['telephone'])      : '';	$mobile     = isset($_REQUEST['mobile'])        ? trim($_REQUEST['mobile'])         : '';	$fax        = isset($_REQUEST['fax'])           ? trim($_REQUEST['fax'])            : '';	$email      = isset($_REQUEST['email'])         ? trim($_REQUEST['email'])          : '';	if ($nom == '') { $nom = '-'; }	// On gère le "+" qui ne passe pas en ajax et qui a été remplaçé par un #	$fax        = str_replace('#', '+', $fax);	$telephone  = str_replace('#', '+', $telephone);	$mobile     = str_replace('#', '+', $mobile);	$contact = $id_contact > 0 ? $contactManager->getContact($id_contact) : new Contact([]);	if (!$contact instanceof Contact) { exit('RQ9C6O9A/'.$id_contact); }	if ($id_client == 0) { exit('KWY1BAIA'); }	$contact->setId_tiers($id_client);	$contact->setNom(strtoupper($nom));	$contact->setPrenom(ucwords(strtolower($prenom)));	$contact->setTelephone($telephone);	$contact->setMobile($mobile);	$contact->setFax($fax);	$contact->setEmail($email);	if ($id_contact == 0) {		$contact->setDate_add(date('Y-m-d H:i:s'));    } else {		$contact->setDate_maj(date('Y-m-d H:i:s'));    }	if (!$contactManager->saveContact($contact)) { exit('U0PD0ZEQ/'.$id_contact); }	$log = new Log([]);	$log->setLog_type('info');	$logtexte = $id_contact > 0 ? "Modification du contact ID " . $id_contact : "Création d'un nouveau contact pour le tiers ID " . $id_client;	$log->setLog_texte($logtexte);	$logsManager->saveLog($log);	echo '1';	exit;} // FIN mode/* -------------------------------------------------MODE - Enregistre une adresse (add/upd)--------------------------------------------------*/function modeAddUpdAdresse() {    global $cnx, $logsManager;    $adressesManager = new AdresseManager($cnx);    $id_adresse = isset($_REQUEST['id_adresse'])    ? intval($_REQUEST['id_adresse'])   : 0;    $id_client  = isset($_REQUEST['id_client'])     ? intval($_REQUEST['id_client'])    : 0;    $nom        = isset($_REQUEST['nom'])           ? trim($_REQUEST['nom'])            : '';    $adresse_1  = isset($_REQUEST['adresse_1'])     ? trim($_REQUEST['adresse_1'])      : '';    $adresse_2  = isset($_REQUEST['adresse_2'])     ? trim($_REQUEST['adresse_2'])      : '';    $cp         = isset($_REQUEST['cp'])            ? trim($_REQUEST['cp'])             : '';    $ville      = isset($_REQUEST['ville'])         ? trim($_REQUEST['ville'])          : '';    $id_pays    = isset($_REQUEST['id_pays'])       ? intval($_REQUEST['id_pays'])      : 0;    $type       = isset($_REQUEST['type'])          ? 1 : 0;    $adresse = $id_adresse > 0 ? $adressesManager->getAdresse($id_adresse) : new Adresse([]);    if (!$adresse instanceof Adresse) { exit('KMZ1LOCR/'.$id_adresse); }    if ($id_client == 0) { exit('6WM0FE6U'); }    if ($id_pays == 0) { exit('8WARE2YL'); }    $adresse->setId_tiers($id_client);    $adresse->setNom($nom);	$adresse->setAdresse_1($adresse_1);	$adresse->setAdresse_2($adresse_2);	$adresse->setCp($cp);	$adresse->setVille($ville);	$adresse->setId_pays($id_pays);	$adresse->setType($type);	if (!$adressesManager->saveAdresse($adresse)) { exit('RJ0506B0/'.$id_adresse); }	$log = new Log([]);	$log->setLog_type('info');	$logtexte = $id_adresse > 0 ? "Modification de l'adresse ID " . $id_adresse : "Création d'une nouvelle adresse pour le tiers ID " . $id_client;	$log->setLog_texte($logtexte);	$logsManager->saveLog($log);	echo '1';    exit;} // FIN mode/* -------------------------------------------------MODE - Supprime une adresse--------------------------------------------------*/function modeSupprAdresse() {	global $cnx, $logsManager;	$adressesManager = new AdresseManager($cnx);	$id_adresse = isset($_REQUEST['id_adresse'])    ? intval($_REQUEST['id_adresse'])   : 0;	if ($id_adresse == 0) { exit('KU4YM963'); }	$adresse = $adressesManager->getAdresse($id_adresse);	if (!$adresse instanceof Adresse) { exit('KU8JCT2O/'.$id_adresse); }	$adresse->setSupprime(1);	if (!$adressesManager->saveAdresse($adresse)) { exit('AQVFDJID/'.$id_adresse); }	$log = new Log([]);	$log->setLog_type('info');	$log->setLog_texte("Suppression de l'adresse ID " . $id_adresse);	$logsManager->saveLog($log);	echo '1';	exit;} // FIN mode/* -------------------------------------------------MODE - Supprime un contact--------------------------------------------------*/function modeSupprContact() {	global $cnx, $logsManager;	$contactsManager = new ContactManager($cnx);	$id_contact = isset($_REQUEST['id_contact'])    ? intval($_REQUEST['id_contact'])   : 0;	if ($id_contact == 0) { exit('PU75UR0T'); }	$contact = $contactsManager->getContact($id_contact);	if (!$contact instanceof Contact) { exit('C3VQ0XYL/'.$id_contact); }	$contact->setSupprime(1);	if (!$contactsManager->saveContact($contact)) { exit('Z6HO0KR5/'.$id_contact); }	$log = new Log([]);	$log->setLog_type('info');	$log->setLog_texte("Suppression du contact ID " . $id_contact);	$logsManager->saveLog($log);	echo '1';	exit;} // FIN mode/* ------------------------------------MODE - Modale groupes client (admin)------------------------------------*/function modeModalGroupes() {	global        $utilisateur,        $tiersManager,        $cnx;	// On vérifie qu'on est bien loggé	if (!isset($_SESSION['logged_user'])) { exit;}	// On instancie l'utilisateur en session s'il ne l'est pas déjà	if (!isset($utilisateur)) { $utilisateur = unserialize($_SESSION['logged_user']); }	$groupes = $tiersManager->getListeTiersGroupes();	$id_groupe = isset($_REQUEST['id_groupe']) ? intval($_REQUEST['id_groupe']) : 0;	$groupeEdit = $id_groupe > 0 ? $tiersManager->getTiersGroupe($id_groupe) : new TiersGroupe([]);	?>    <div class="row">        <div class="col-8">			<?php			if (empty($groupes)) { ?>                <div class="alert alert-warning text-center padding-50">                    Aucun groupe client&hellip;                </div>			<?php } else { ?>                <table class="table admin">                    <thead>                    <tr>                        <th>Nom</th>                        <th>Clients</th>                        <th class="t-actions w-mini-admin-cell text-center">Modif.</th>                        <th class="t-actions w-mini-admin-cell text-center">Suppr.</th>                    </tr>                    </thead>                    <tbody>					<?php					foreach ($groupes as $groupe) { ?>                        <tr data-id="<?php echo $groupe->getId(); ?>"  <?php echo $id_groupe == $groupe->getId() ? 'class="bg-info text-white"' : ''; ?>>                            <td><?php echo strtoupper($groupe->getNom());?></td>                            <td>								<?php								if (empty($groupe->getTiers())) { ?>									<span class="badge badge-warning badge-pill text-14">Aucun</span>								<?php }								foreach ($groupe->getTiers() as $tiersGrp) { ?>									<span class="badge badge-secondary texte-fin text-13 badge-pill mr-2"><?php echo $tiersGrp->getNom(); ?></span>								<?php }								?>							</td>                            <td class="<?php echo $id_groupe != $groupe->getId() ? 't-actions' : ''; ?> text-center">								<?php if ($id_groupe == $groupe->getId()) { ?>                                    <i class="fa fa-edit fa-lg"></i>								<?php } else { ?>                                    <button type="button" class="btn btn-sm btn-secondary btnEditGroupe"><i class="fa fa-edit"></i></button>								<?php } ?>                            </td>                            <td class="<?php echo $id_groupe != $groupe->getId() ? 't-actions' : ''; ?> text-center">								<?php if ($id_groupe == $groupe->getId()) { ?>                                    <i class="fa fa-arrow-right fa-lg"></i>								<?php } else { ?>                                    <button type="button" class="btn btn-sm btn-danger btnSupprGroupe"><i class="fa fa-trash-alt"></i></button>								<?php } ?>                            </td>                        </tr>					<?php }					?>                    </tbody>                </table>			<?php } ?>        </div>        <div class="col-4">            <div class="alert alert-secondary">                <p class="nomargin gris-5"><i class="fa <?php echo $id_groupe == 0 ? 'fa-plus-square' : 'fa-edit'; ?> mr-1 gris-9"></i> <?php echo $id_groupe == 0 ? 'Nouveau' : 'Modification'; ?> groupe client :</p>                <hr class="margin-5">                <form id="addUpdGroupeClt">                    <input type="hidden" name="mode" value="addUpdGroupe"/>                    <input type="hidden" name="id_groupe" value="<?php echo $id_groupe; ?>"/>                    <div class="row mb-2">                        <div class="col-12">                            <span class="texte-fin text-13">Nom :</span>                            <div class="input-group">                                <input type="text" class="form-control" placeholder="Nom du groupe client" name="nom" maxlength="255" value="<?php echo $id_groupe > 0 ? $groupeEdit->getNom() : ''; ?>"/>                            </div>                        </div>                    </div>                    <div class="row">                        <div class="col">                            <button type="button" class="btn btn-success form-control btnAddUpdGroupe">                                <i class="fa fa-check mr-1"></i> <?php echo $id_groupe > 0 ? 'Enregistrer' : 'Ajouter'; ?>                            </button>                        </div>                    </div>                </form>            </div>        </div>    </div>	<?php	exit;} // FIN mode/* -------------------------------------------------MODE - Supprime un groupe--------------------------------------------------*/function modeSupprGroupe() {	global $logsManager, $tiersManager;	$id_groupe = isset($_REQUEST['id_groupe']) ? intval($_REQUEST['id_groupe']) : 0;	if ($id_groupe == 0) { exit('PU75UR0T'); }	$groupe = $tiersManager->getTiersGroupe($id_groupe);	if (!$groupe instanceof TiersGroupe) { exit('C3VQ0XYL/'.$id_groupe); }	$groupe->setSupprime(1);	if (!$tiersManager->saveTiersGroupe($groupe)) { exit('Z6HO0KR5/'.$id_groupe); }	$log = new Log([]);	$log->setLog_type('info');	$log->setLog_texte("Suppression du groupe ID " . $id_groupe);	$logsManager->saveLog($log);	echo '1';	exit;} // FIN mode/* -------------------------------------------------MODE - Enregistre un groupe (add/upd)--------------------------------------------------*/function modeAddUpdGroupe() {	global $tiersManager, $logsManager;	$id_groupe  = isset($_REQUEST['id_groupe'])    ? intval($_REQUEST['id_groupe'])   : 0;	$nom        = isset($_REQUEST['nom'])           ? trim($_REQUEST['nom'])            : '';	if ($nom == '') { exit; }	$groupe = $id_groupe > 0 ? $tiersManager->getTiersGroupe($id_groupe) : new TiersGroupe([]);	if (!$groupe instanceof TiersGroupe) { exit('RQ9C6O9A/'.$id_groupe); }	$groupe->setNom(strtoupper($nom));	$groupe->setActif(1);	if ($id_groupe == 0) {		$groupe->setDate_add(date('Y-m-d H:i:s'));	} else {		$groupe->setDate_maj(date('Y-m-d H:i:s'));	}	if (!$tiersManager->saveTiersGroupe($groupe)) { exit('U0PD0ZEQ/'.$id_groupe); }	$log = new Log([]);	$log->setLog_type('info');	$logtexte = $id_groupe > 0 ? "Modification du groupe client ID " . $id_groupe : "Création d'un nouveau groupe client " . str_replace('"', '',$nom);	$log->setLog_texte($logtexte);	$logsManager->saveLog($log);	echo '1';	exit;} // FIN mode/* -------------------------------------------------MODE - Retourne les options d'un select adresses--------------------------------------------------*/function modeAdressesCltSelect() {	global $tiersManager;	$id_clt = isset($_REQUEST['id_clt']) ? intval($_REQUEST['id_clt']) : 0;	if ($id_clt == 0) { exit('-1'); }	$clt = $tiersManager->getTiers($id_clt);	if (!$clt instanceof Tiers) { exit('-2'); }	if (empty($clt->getAdresses())) { ?>	    <option value="0">Aucune adresse pour ce client !</option>    <?php }	foreach ($clt->getAdresses() as $adresse) { ?>	    <option value="<?php echo $adresse->getId(); ?>" <?php echo $adresse->getType() == 1 ? 'selected' : ''; ?>><?php echo $adresse->getAdresse_ligne(); ?></option>    <?php }	exit;} // FIN mode/* -------------------------------------------------MODE - Retourne l'ID du transporteur par défaut--------------------------------------------------*/function modeGetIdTransporteurClient() {	global $tiersManager;	$id_clt = isset($_REQUEST['id_client']) ? intval($_REQUEST['id_client']) : 0;	if ($id_clt == 0) { exit('-1'); }	$clt = $tiersManager->getTiers($id_clt);	if (!$clt instanceof Tiers) { exit('-2'); }	echo $clt->getId_transporteur();	exit;} // FIN mode