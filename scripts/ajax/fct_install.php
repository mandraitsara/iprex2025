<?php/*   _|_|_|  _|_|_|      _|_| _|        _|    _|  _|    _|  CBO FrameWork _|        _|_|_|    _|    _|  (c) 2018 Cédric Bouillon _|        _|    _|  _|    _|   _|_|_|  _|_|_|      _|_|--------------------------------------------------------Contrôleur Ajax du FrameWork pour l'installationSANS APPEL A CONFIG (INSTALL EN COURS)------------------------------------------------------*//** ***************************************** *  /!\ NE PAS EDITER CE FICHIER COEUR  * **************************************** */$mode = isset($_REQUEST['mode']) ? $_REQUEST['mode'] : '';$fonctionNom = 'mode'.ucfirst($mode);if (function_exists($fonctionNom)) {	$fonctionNom();}/* ------------------------------------ 	Envoi un mail de test ------------------------------------*/function modeTestMail()  {	session_name("PHPSESSID_CBOF");	session_start();	$conf_smtp 		= isset($_REQUEST['conf_smtp']) && intval($_REQUEST['conf_smtp']) == 1;	$conf_smtp_port = isset($_REQUEST['conf_smtp_port']) 	? intval($_REQUEST['conf_smtp_port']) 			: 0;	$conf_email 	= isset($_REQUEST['conf_email']) 		? trim(strtolower($_REQUEST['conf_email'])) 	: '';	$conf_smtp_host = isset($_REQUEST['conf_smtp_host']) 	? trim(strtolower($_REQUEST['conf_smtp_host'])) : '';	$conf_smtp_user = isset($_REQUEST['conf_smtp_user']) 	? $_REQUEST['conf_smtp_user'] 					: '';	$conf_smtp_pw 	= isset($_REQUEST['conf_smtp_pw']) 		? $_REQUEST['conf_smtp_pw'] 					: '';	$_SESSION['usesmtp'] = $conf_smtp;	if ($conf_smtp) {		$_SESSION['smtp_username'] 		= $conf_smtp_user;		$_SESSION['smtp_password'] 		= $conf_smtp_pw;		$_SESSION['smtp_port'] 			= $conf_smtp_port;		$_SESSION['smtp_server']		= $conf_smtp_host;	} else {		unset($_SESSION['smtp_username']);		unset($_SESSION['smtp_password']);		unset($_SESSION['smtp_port']);		unset($_SESSION['smtp_server']);	}	$corps = "Ceci est un test d'envoi d'e-mail effectu&eacute; le " . date('d/m/Y - H:i:s') . " avec les paramètres suivants :";	$corps.='<ul>';	$corps.= '<li><strong>SMTP : </strong>';	$corps.= $conf_smtp ? 'Oui' : 'Non';	$corps.= '</li>';	if ($conf_smtp) {		$corps.= '<li><strong>Adresse de l\'hôte : </strong>'.$conf_smtp_host.'</li>';		$corps.= '<li><strong>Port : </strong>'.$conf_smtp_port.'</li>';		$corps.= '<li><strong>Utilisateur : </strong>'.$conf_smtp_user.'</li>';		$corps.= '<li><strong>Mot de passe : </strong>'.$conf_smtp_pw.'</li>';	}	$corps.='</ul>';	include_once('../../class/Outils.class.php');	$resultat = Outils::envoiMail(array($conf_email), $conf_email, "CBO FrameWork - Mail de test", utf8_decode($corps));	echo 'ok~';	echo $resultat == true		? '<span class="text-success"><i class="fa fa-check mr-1"></i> Envoi réussi !</span>'		: '<span class="text-danger"><i class="fa fa-exclamation-triangle mr-1"></i> Erreur lors de l\'envoi !</span>';	unset($_SESSION['smtp_username']);	unset($_SESSION['smtp_password']);	unset($_SESSION['smtp_port']);	unset($_SESSION['smtp_server']);	unset($_SESSION['usesmtp']);	exit;}// FIN mode/* ------------------------------------ 	Teste la connexion PDO ------------------------------------*/function modeTestCnx() {	$host 	= isset($_REQUEST['host']) 	? trim($_REQUEST['host']) 	: '';	$port 	= isset($_REQUEST['port']) 	? intval($_REQUEST['port']) : 0;	$bdd 	= isset($_REQUEST['bdd']) 	? trim($_REQUEST['bdd']) 	: 0;	$user 	= isset($_REQUEST['user']) 	? trim($_REQUEST['user']) 	: 0;	$pw 	= isset($_REQUEST['pw']) 	? trim($_REQUEST['pw']) 	: 0;	$connexionString = 'mysql:host='.$host.';';	$connexionString.= $port > 0 ? 'port='.$port.';' : '';	$connexionString.= 'dbname='.$bdd;	$test = false;	try {		$cnx = new PDO($connexionString, $user, $pw);		$cnx->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_WARNING);		$test = true;	} catch (Exception $e) {		$test = false;	}	echo 'ok~';	echo $test		? '<span class="text-success"><i class="fa fa-check mr-1"></i> Connextion établie !</span>'		: '<span class="text-danger"><i class="fa fa-exclamation-triangle mr-1"></i> Connextion echouée !</span>';	exit;} // FIN mode