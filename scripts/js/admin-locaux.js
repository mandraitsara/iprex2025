/** ------------------------------------------------------------------------ JS Copyright (C) 2020 Intersed http://www.intersed.fr/ ------------------------------------------------------------------------ @author    Cédric Bouillon @copyright Copyright (c) 2020 Intersed @version   1.0 @since     2018 ------------------------------------------------------------------------ */$(document).ready(function() {    "use strict";    // Affiche la liste    chargeListe();    // Nettoyage du contenu de la modale à sa fermeture    $('#modalAddUpd').on('hidden.bs.modal', function (e) {        $('#modalAddUpdTitre').html('<i class="fa fa-spin fa-spinner fa-2x"></i>');        $('#modalAddUpdBody').html('<i class="fa fa-spin fa-spinner fa-2x"></i>');        $('#modalAddUpd .btnSupprimer').show();    }); // FIN fermeture modale    $('.btnAddNew').off("click.btnAddNew").on("click.btnAddNew", function(e) {        e.preventDefault();        var type = $(this).data('type');        if (type !== 'zone' && type !== 'local') { alert('Erreur identification type !');return false; }        $('#modalAddUpd .btnSupprimer').hide();        $.fn.ajax({            script_execute: 'fct_planning_nettoyage.php',            arguments: 'mode=chargeModaleAddUpd&type='+type,            callBack: function(retour) {                var retours = retour.toString().split('^');                var titre = retours[0];                var body = retours[1];                $('#modalAddUpdTitre').html(titre);                $('#modalAddUpdBody').html(body);                $('#modalAddUpd').modal('show');                modaleAddUpdListener();            } // FIN Callback        }); // FIN ajax    });}); // FIN ready/** ********************** * Affiche la liste ********************** */function chargeListe() {    "use strict";    $.fn.ajax({        script_execute: 'fct_planning_nettoyage.php',        arguments: 'mode=showListeLocaux',        return_id: 'liste',        done: function () {            listeListener();        } // FIN Callback    }); // FIN ajax    return true;} // FIN fonction/** ************************ * Listener de la liste ************************ */function listeListener() {    "use strict";    $('.btnEdit').off("click.btnEdit").on("click.btnEdit", function(e) {        e.preventDefault();        var type = $(this).data('type');        if (type !== 'zone' && type !== 'local') { alert('Erreur identification type !');return false; }        var id = parseInt($(this).parents('tr').find('kbd').text());        if (isNaN(id)) { id = 0; }        if (id === 0) { alert('Identification ID échouée !'); return false; }        $.fn.ajax({            script_execute: 'fct_planning_nettoyage.php',            arguments: 'mode=chargeModaleAddUpd&id='+id+'&type='+type,            callBack: function(retour) {                var retours = retour.toString().split('^');                var titre = retours[0];                var body = retours[1];                $('#modalAddUpdTitre').html(titre);                $('#modalAddUpdBody').html(body);                $('#modalAddUpd').modal('show');                modaleAddUpdListener();            } // FIN Callback        }); // FIN ajax    });} // FIN fonction/** ************************ * Listener de la modale ************************ */function modaleAddUpdListener() {    "use strict";    $('.selectpicker').selectpicker();    $('.selectpicker').selectpicker('render');    $('.btnSave').off("click.btnSave").on("click.btnSave", function(e) {        e.preventDefault();        if ($('#modalAddUpdBody input[name=nom]').val().trim().length === 0) { return false; }        var nom = cleanCharsToAjax($('#modalAddUpdBody input[name=nom]').val());        $('#modalAddUpdBody input[name=nom]').val(nom);        var ln = loadingBtn($(this));        $.fn.ajax({            script_execute: 'fct_planning_nettoyage.php',            form_id: 'modalAddUpdBody',            callBack: function (retour) {                retour+= '';                removeLoadingBtn(ln);                if (parseInt(retour) !== 1) { alert('ERREUR !\r\nEchec de l\'enregistement...\r\nCode erreur : '+retour); return false; }                $('#modalAddUpd').modal('hide');                chargeListe();            } // FIN Callback        }); // FIN ajax    }); // FIN SAVE    $('.btnSupprimer').off("click.btnSupprimer").on("click.btnSupprimer", function(e) {        e.preventDefault();        var type = $('#modalAddUpdBody input[name=type]').val();        var id = parseInt($('#modalAddUpdBody input[name=id]').val());        if (isNaN(id)) { id = 0; }        if (type !== 'zone' && type !== 'local') { alert('Identification type échoéue !');return false; }        if (id === 0) { alert('Identification ID échouée !'); return false;}        var txtType = type === 'zone' ? 'cette ' + type : 'ce ' + type;        if (!confirm('Supprimer définitivement '+txtType+' ?')) { return false; }        var ln = loadingBtn($(this));        $.fn.ajax({            script_execute: 'fct_planning_nettoyage.php',            arguments: 'mode=supprLocal&id='+id+'&type='+type,            callBack: function (retour) {                retour+= '';                removeLoadingBtn(ln);                if (parseInt(retour) !== 1) { alert('ERREUR !\r\nEchec de la suppression...\r\nCode erreur : '+retour); return false; }                $('#modalAddUpd').modal('hide');                chargeListe();            } // FIN Callback        }); // FIN ajax    }); // FIN SUPPR} // FIN fonction