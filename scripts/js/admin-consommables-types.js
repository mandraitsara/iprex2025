/** ------------------------------------------------------------------------ JS - Admin types de consommables Copyright (C) 2019 Intersed http://www.intersed.fr/ ------------------------------------------------------------------------ @author    Cédric Bouillon @copyright Copyright (c) 2019 Intersed @version   1.0 @since     2019 ------------------------------------------------------------------------ */$(document).ready(function() {    "use strict";    // Affiche la liste des types de consommables (aJax)    chargeListeTypesConsommables();    // Export PDF    $('.btnExportPdf').click(function() {        var objetDomBtnExport = $(this);        objetDomBtnExport.find('i').removeClass('fa-file-pdf').addClass('fa-spin fa-spinner');        objetDomBtnExport.attr('disabled', 'disabled');        $.fn.ajax({            'script_execute': 'fct_consommables.php',            'arguments': 'mode=exportPdf&type=types',            'callBack' : function (url_fichier) {                objetDomBtnExport.find('i').removeClass('fa-spin fa-spinner').addClass('fa-file-pdf');                objetDomBtnExport.prop('disabled', false);                $('#lienPdf').attr('href', url_fichier);                $('#lienPdf')[0].click();            } // FIN callBack        }); // FIN ajax    }); // FIN bouton PDF    // Chargement du contenu de la modale Type de Consommable à son ouverture    $('#modalTypeConsommable').on('show.bs.modal', function (e) {        // On récupère l'ID du type.        var type_id = e.relatedTarget.attributes['data-type-id'] === undefined ? 0 : parseInt(e.relatedTarget.attributes['data-type-id'].value);        // On récupère le contenu de la modale        $.fn.ajax({            'script_execute': 'fct_consommables.php',            'arguments': 'mode=modalTypeConsommable&id=' + type_id,            'callBack': function (retour) {                // On intègre les différents contenus                var retours = retour.toString().split('^');                var titre = retours[0];                var body = retours[1];                var footer = retours[2];                $('#modalTypeConsommableTitre').html(titre);                $('#modalTypeConsommableBody').html(body);                $('#modalTypeConsommableFooter').html(footer);                // Initialisation des outils JS                $('.togglemaster').bootstrapToggle();                $('[data-toggle="tooltip"]').tooltip();                // Appel au listener de la modale                consommableTypeModalListener();            } // FIN Callback        }); // FIN aJax    }); // Fin chargement du contenu de la modale    // Nettoyage du contenu de la modale Détails à sa fermeture    $('#modalTypeConsommable').on('hidden.bs.modal', function (e) {        $('#modalTypeConsommableTitre').html('<i class="fa fa-spin fa-spinner fa-2x"></i>');        $('#modalTypeConsommableBody').html('<i class="fa fa-spin fa-spinner fa-2x"></i>');        $('#modalTypeConsommableFooter').html('<i class="fa fa-spin fa-spinner fa-2x"></i>');    }); // FIN fermeture modale Détails}); // FIN ready/** ****************************************** * Listener de la modale Consommable Type ****************************************** */function consommableTypeModalListener() {    $('#input_nom').focus();    // --------------------------------    // Bouton Enregistrer    // --------------------------------    $('.btnsaveConsommableType').off("click.btnsaveConsommableType").on("click.btnsaveConsommableType", function(e) {        e.preventDefault();        // Initialisation des variables        var erreurs             = false;        // Si le champ libellé est vide        if ($('#input_nom').val().length < 1 || $('#input_nom').val() === '') {            // On affiche l'invalidité sur le champ correspondant (Bootstrap) pendant 3 secondes            $('#input_nom').addClass('is-invalid');            setTimeout(function(){                $('#input_nom').removeClass('is-invalid');            }, 3000);            // On déclare l'erreur            erreurs = true;        } // FIN test validité du champ        // Si pas d'erreur jusque là on continue...        if (erreurs === false) {            goAddUpd();        } // FIN test pas d'erreur        return false;    }); // FIN bouton Enregistrer    // --------------------------------    // Bouton Supprimer    // --------------------------------    $('.btnSupprimeTypeEmballage').off("click.btnSupprimeTypeEmballage").on("click.btnSupprimeTypeEmballage", function(e) {        e.preventDefault();        // Si on ne trouve pas l'ID du type, on ne va pas plus loin...        if ( $('#formConsommablesTypesAddUpd').find('input[name=type_id]') === undefined) { return false; }        // On initialise, formate et contrôle l'ID du consommable        var type_id = parseInt($('#formConsommablesTypesAddUpd').find('input[name=type_id]').val());        if (type_id === 0) { return false; }        // Message de confirmation        var texte = "CONFIRMER\r\nVous allez supprimer ce type de consommables.\r\nContinuer ?";        if (!confirm(texte)) { return false; }        // Confirmation OK, on supprime l'emballage (aJax)        $.fn.ajax({            'script_execute': 'fct_consommables.php',            'arguments': 'mode=supprConsommablesTypes&type_id='+type_id,            'callBack': function () {                // On recharge la liste à jour des emballages et on ferme la modale.                chargeListeTypesConsommables();                $('#modalTypeConsommable').modal('hide');            } // FIN callback        }); // FIN ajax        return false;    }); // FIN bouton supprime} // FIN listener/** ****************************************** * Affiche la liste des types de consommables ****************************************** */function chargeListeTypesConsommables() {    $.fn.ajax({        'script_execute': 'fct_consommables.php',        'arguments': 'mode=showListeTypesConsommables',        'return_id': 'listesTypesConsommables',        'done' : function() {            listeTypesConsommablesListener();        }    }); // FIN ajax    return true;} // FIN fonction/** ****************************************** * Valide l'enregistrement ****************************************** */function goAddUpd () {    "use strict";    // On échape les esperluettes pour l'ajax    var nomClean = $('#input_nom').val().replace('&', '#et#');    $('#input_nom').val(nomClean);    $.fn.ajax({        'script_execute': 'fct_consommables.php',        'form_id': 'formConsommablesTypesAddUpd',        'callBack': function () {            // on recharge la liste à jour et on ferme la modale            chargeListeTypesConsommables();            $('#modalTypeConsommable').modal('hide');        } // FIN callback    }); // FIN ajax    return false;} // FIN fonction/** ******************************************** * Listener de la liste de types de consommables ******************************************** */function listeTypesConsommablesListener() {/*    $('.icheck').iCheck({radioClass: 'iradio_square-blue'});    // Pagination Ajax    $(document).on('click','#listeEmballages .pagination li a',function(){        if ($(this).attr('data-url') === undefined) { return false; }        // on affiche le loading d'attente        $('#listeProduits').html('<i class="fa fa-spin fa-spinner fa-2x"></i>');        // on fait l'appel ajax qui va rafraichir la liste        $.fn.ajax({script_execute:'fct_emballages.php'+$(this).attr('data-url'),return_id:'listeEmballages'});        // on désactive le lien hypertexte        return false;    }); // FIN pagination ajax*/} // FIN fonction