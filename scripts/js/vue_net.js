/** ------------------------------------------------------------------------ JS - Vue Nettoyage Copyright (C) 2020 Intersed http://www.intersed.fr/ ------------------------------------------------------------------------ @author    Cédric Bouillon @copyright Copyright (c) 2020 Intersed @version   1.0 @since     2019 ------------------------------------------------------------------------ */$('document').ready(function() {    "use strict";    if ($('#stkAjaxVue').data('direct') === 'avant') {        var idavant = parseInt($('#stkAjaxVue').data('id'));        if (isNaN(idavant)) { idavant = 0; }        if (idavant > 0) {            chargeEtape(1, idavant);            return false;        }        chargeEtape(1, 0);    } else if ($('#stkAjaxVue').data('direct') === 'pendant') {        var id_lot = parseInt($('#stkAjaxVue').data('id-lot'));        var id = parseInt($('#stkAjaxVue').data('id'));        if (isNaN(id_lot)) { id_lot = 0; }        if (isNaN(id)) { id = 0; }        if (id > 0) {            chargeEtape(21, 'id'+id);            return false;        }        chargeEtape(21, id_lot);    } else if ($('#stkAjaxVue').data('direct') === 'apres') {        var idapres = parseInt($('#stkAjaxVue').data('id'));        if (isNaN(idapres)) { idapres = 0; }        if (idapres > 0) {            chargeEtape(3, 'id'+idapres);            return false;        }        chargeEtape(0, 0);    } else {        chargeEtape(0, 0);    }}); // FIN readyfunction chargeEtape(numeroEtape, identifiant) {    $('#stkAjaxVue').html('<div class="padding-50 text-center"><i class="fa fa-spin fa-spinner fa-5x gris-c"></i></div>');    // Ajax qui charge le contenu de l'étape    $.fn.ajax({        'rep_script_execute': "../scripts/ajax/", // Gestion de l'URL Rewriting        'script_execute': 'fct_vue_net.php',        'arguments': 'mode=chargeEtapeVue&etape=' + numeroEtape + '&id='+identifiant,        'return_id': 'stkAjaxVue',        'done': function () {            var fctnom = "listenerEtape"+numeroEtape;            var fn  = window[fctnom];            fn(identifiant);        } // FIN Callback    }); // FIN ajax} // FIN fonction chargeEtape// Listener de l'étape 0function listenerEtape0() {    "use strict";    $('.btnEtape').off("click.btnEtape").on("click.btnEtape", function(e) {        e.preventDefault();        var etape = parseInt($(this).data('etape'));        if (isNaN(etape)) { etape = 0; }        if (etape === 0) { return false; }        chargeEtape(etape,0);    });} // FIN listener// Listener de l'étape 1function listenerEtape1() {    "use strict";    clavierVirtuel();    // MAJ JCA CLICK POUR ECRAN TACTILE    $('.ichecktout').click(function(e) {        e.preventDefault();        $(this).find('.icheck').iCheck('toggle');    });    $('.icheck.icheck-rouge').iCheck({ radioClass: 'iradio_flat-red'});    $('.icheck.icheck-vert').iCheck({ radioClass: 'iradio_flat-green'});    $('.btnRetourEtape0').off("click.btnRetourEtape0").on("click.btnRetourEtape0", function(e) {        e.preventDefault();        chargeEtape(0,0);    });    $('.btnToutOk').off("click.btnToutOk").on("click.btnToutOk", function(e) {        e.preventDefault();        var id_parent = parseInt($(this).data('id-parent'));        if (isNaN(id_parent)) { id_parent = 0; }        if (id_parent === 0) { return false; }        $('.icheck.parent-'+id_parent).iCheck('check');    }); // FIN tout ok    $('.btnSigner').off("click.btnSigner").on("click.btnSigner", function(e) {        e.preventDefault();        // On vérifie que tout est coché à oui ou non        var names = {};        $('.icheck-pvisu').each(function() {            names[$(this).attr('name')] = true;        });        var count = 0;        $.each(names, function() { // then count them            count++;        });        if ($('.icheck-pvisu:checked').length !== count) {            $('#modalInfoBody').html('<h4><i class="fa fa-2x fa-exclamation-triangle mb1 text-danger"></i><div class="alert alert-danger mt-2 text-16">Tous les postes doivent être cochés avant de valider...</div></h4>');            $('#modalInfo').modal('show');           return false;        }        // OK... ajax save + retour etape 0        $.fn.ajax({            'rep_script_execute': "../scripts/ajax/", // Gestion de l'URL Rewriting            'script_execute': 'fct_vue_net.php',            'form_id': 'formEtape',            'callBack': function (retour) {                retour+= '';                if (parseInt(retour) !== 1) {                    alert('Echec de l\'enregistrement !');                    return false;                }                chargeEtape(0,0);            } // FIN Callback        }); // FIN ajax    }); // FIN valider} // FIN listener// Listener de l'étape 2function listenerEtape2() {    "use strict";    listenerSelectionLot();} // FIN listener// Listener de l'étape 3function listenerEtape3() {    "use strict";        // Retour Etape 0    $('.btnRetourEtape0').off("click.btnRetourEtape0").on("click.btnRetourEtape0", function(e) {        e.preventDefault();        chargeEtape(0,0);    });    clavierVirtuel();    $('.icheck.icheck-rouge').iCheck({ radioClass: 'iradio_flat-red'});    $('.icheck.icheck-vert').iCheck({ radioClass: 'iradio_flat-green'});    $('.togglemaster').bootstrapToggle();    $('.selectpicker').selectpicker('render');    $('.btnToutOk').off("click.btnToutOk").on("click.btnToutOk", function(e) {        e.preventDefault();        $('.icheck-vert').iCheck('check');    }); // FIN tout ok    $('.btnSigner').off("click.btnSigner").on("click.btnSigner", function(e) {        e.preventDefault();        // On vérifie que tout est coché à oui ou non        var names = {};        $('.icheck-pvisu').each(function() {            names[$(this).attr('name')] = true;        });        var count = 0;        $.each(names, function() { // then count them            count++;        });        if ($('.icheck-pvisu:checked').length !== count) {            $('#modalInfoBody').html('<h4><i class="fa fa-2x fa-exclamation-triangle mb1 text-danger"></i><div class="alert alert-danger mt-2 text-16">Tous les incidents doivent être cochés avant de valider...</div></h4>');            $('#modalInfo').modal('show');            return false;        }        // OK... ajax save + retour etape 0        $.fn.ajax({            'rep_script_execute': "../scripts/ajax/", // Gestion de l'URL Rewriting            'script_execute': 'fct_vue_net.php',            'form_id': 'formEtape',            'callBack': function (retour) {                retour+= '';                if (parseInt(retour) !== 1) {                    alert('Echec de l\'enregistrement !');                    return false;                }                var bo = parseInt($('#formEtape input[name=bo]').val());                if (isNaN(bo)) { bo = 0; }                if (bo === 1) {                    $(location).attr('href','../admin-nettoyage.php');                } else {                    chargeEtape(0,0);                }            } // FIN Callback        }); // FIN ajax    }); // FIN valider            } // FIN listener// listener commun pour la sélection du lot (Etapes 2 et 3)function listenerSelectionLot() {    "use strict";    // Retour Etape 0    $('.btnRetourEtape0').off("click.btnRetourEtape0").on("click.btnRetourEtape0", function(e) {        e.preventDefault();        chargeEtape(0,0);    });    // Selection lot    $('.carte-lot').off("click.cartelot").on("click.cartelot", function(e) {        e.preventDefault();        var id_lot = parseInt($(this).data('id-lot'));        if (isNaN(id_lot)) { id_lot = 0 ;}        if (id_lot === 0) { alert("Echec de l'identification du lot !");return false; }        var etape_suivante = parseInt($(this).data('etape-suivante'));        if (isNaN(etape_suivante)) { etape_suivante = 0 ;}        if (etape_suivante === 0) { alert("Echec de l'identification de l'étape suivante !");return false; }        chargeEtape(etape_suivante,id_lot);    });} // FIN listener// Listener de l'étape 21function listenerEtape21() {    "use strict";    // Retour Etape 0    $('.btnRetourEtape0').off("click.btnRetourEtape0").on("click.btnRetourEtape0", function(e) {        e.preventDefault();        chargeEtape(0,0);    });    clavierVirtuel();    $('.icheck.icheck-rouge').click(function(){        console.log('toto')    });    $('.icheck.icheck-rouge').iCheck({ radioClass: 'iradio_flat-red'});    $('.icheck.icheck-vert').iCheck({ radioClass: 'iradio_flat-green'});    $('.togglemaster').bootstrapToggle();    $('.selectpicker').selectpicker('render');    $('.btnToutOk').off("click.btnToutOk").on("click.btnToutOk", function(e) {        e.preventDefault();        $('.icheck-vert').iCheck('check');    }); // FIN tout ok    $('.btnSigner').off("click.btnSigner").on("click.btnSigner", function(e) {        e.preventDefault();        // On vérifie que tout est coché à oui ou non        var names = {};        $('.icheck-pvisu').each(function() {            names[$(this).attr('name')] = true;        });        var count = 0;        $.each(names, function() { // then count them            count++;        });        if ($('.icheck-pvisu:checked').length !== count) {            $('#modalInfoBody').html('<h4><i class="fa fa-2x fa-exclamation-triangle mb1 text-danger"></i><div class="alert alert-danger mt-2 text-16">Tous les incidents doivent être cochés avant de valider...</div></h4>');            $('#modalInfo').modal('show');            return false;        }        // OK... ajax save + retour etape 0        $.fn.ajax({            'rep_script_execute': "../scripts/ajax/", // Gestion de l'URL Rewriting            'script_execute': 'fct_vue_net.php',            'form_id': 'formEtape',            'callBack': function (retour) {                retour+= '';                if (parseInt(retour) !== 1) {                    alert('Echec de l\'enregistrement !');                    return false;                }                var urlAtelier = $('#urlAtelier').val();                $(location).attr('href',urlAtelier);            } // FIN Callback        }); // FIN ajax    }); // FIN valider} // FIN listener// Listener de l'étape 31function listenerEtape31() {    "use strict";/*    // Retour Etape 0    $('.btnRetourEtape0').off("click.btnRetourEtape0").on("click.btnRetourEtape0", function(e) {        e.preventDefault();        chargeEtape(0,0);    });    clavierVirtuel();    $('.icheck.icheck-rouge').iCheck({ radioClass: 'iradio_flat-red'});    $('.icheck.icheck-vert').iCheck({ radioClass: 'iradio_flat-green'});    $('.togglemaster').bootstrapToggle();    $('.selectpicker').selectpicker('render');    $('.btnToutOk').off("click.btnToutOk").on("click.btnToutOk", function(e) {        e.preventDefault();        $('.icheck-vert').iCheck('check');    }); // FIN tout ok*/} // FIN listener/** ------------------------------------------------------------- * Clavier virtuel - Ne pas changer le noms des champs * Ou adapater le fichier jkeyboard.js ------------------------------------------------------------- */function clavierVirtuel() {    $('#champ_clavier').focus(function() {        $('#clavier_virtuel').show("slide" ,{ direction: "down"  });    });    $('.btn').click(function() {        $('#clavier_virtuel').hide("slide" ,{ direction: "down"  });    });    $('#clavier_virtuel').jkeyboard({        input: $('#champ_clavier'),        layout: 'francais',        customLayouts: {            selectable: ["francais"],            francais: [                ['a', 'z', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'],                ['q', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', 'm'],                ['shift', 'w', 'x', 'c', 'v', 'b', 'n', 'backspace'],                ['numeric_switch', 'layout_switch', 'space', 'return']            ],        },    });    return true;}