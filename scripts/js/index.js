/** ------------------------------------------------------------------------ JS - Accueil vues - Général Copyright (C) 2018 Intersed http://www.intersed.fr/ ------------------------------------------------------------------------ @author    Cédric Bouillon @copyright Copyright (c) 2018 Intersed @version   1.0 @since     2018 ------------------------------------------------------------------------ */$('document').ready(function() {    $(document).on('click','.btnConsoleDev',function(){        $('#consoleDev').toggle('fast');        $('#mainFooter').toggle('fast');    });    // Nettoyage du contenu de la modale Infos et du bouton Photo (spinner) à sa fermeture    $('#modalInfo').on('hidden.bs.modal', function (e) {        $('#modalInfoBody').html('<i class="fa fa-spin fa-spinner fa-2x"></i>');        $('.btn-photosapp-vues i').removeClass().addClass('fa fa-camera fa-fw mt-2 mr-1');    }); // FIN fermeture modale Info    // Gestion du bouton "Photos" sur toutes les vues...    $('.btn-photosapp-vues').off("click.btnconfirmereception").on("click.btnconfirmereception", function(e) {        e.preventDefault();        // Si numéro de la vue manquante, on sort (sécurité JS) - Ne devrais pas arriver        if (!$('#idVuePhotos').length) { return false; }        // On récupère le numéro de la vue        var id_vue = parseInt($('#idVuePhotos').val());        // Si aucun lot n'est spécifié dans le ticket (la balise est absente du DOM)        if (!$('#lotid_photo').length) {            modalInfo(1); // Modale d'info : Pas de lot sélectionné.            return false;        }        // On récupère le ou les numéros de lots        var id_lot = $('#lotid_photo').val();        // Si aucun lot dans la balise malgré tout,        if (id_lot === 0 || id_lot === '0' || id_lot === '' || id_lot === undefined) {            modalInfo(1); // Modale d'info : Pas de lot sélectionné.            return false;        }        // Ici on a bien un ou plusieurs numéros de lots (séparés par des virgules), aJax...        $.fn.ajax({            'rep_script_execute': "../scripts/ajax/", // Gestion de l'URL Rewriting            'script_execute': 'fct_api.php',            'arguments': 'mode=prendrePhotos&id_lot='+id_lot+'&id_vue='+id_vue,            'callBack': function (retour) {                // Si une erreur est renvoyée par le script                if (parseInt(retour) < 0) {                    modalInfo(2); // Modal d'info : erreur avec l'API                    return false;                // Sinon, tout s'est bien passé, les lots sont prêts pour l'API                } else {                    // On adapte le message selon s'il y a un ou plusieurs lots                    var msg_code = id_lot.indexOf(",") >= 0 ? 4 : 3;                    modalInfo(msg_code); // Modale d'info : Lot(s) disponible(s) dans l'API                    return true;                } // FIN test retour            } // FIN callback        }); // FIN ajax    }); // FIN bouton Photo    if ($('#maison').length) {        $('#maison').show('fade',1000);    }}); // FIN ready/** * Fonction affiche message d'info en modale * @param msg_code * @returns {boolean} */function modalInfo(msg_code) {    "use strict";    // Si pas de code message, on sort, sinon initialisation du texte    if (msg_code === undefined) { return false; }    var infobody = '';    // On switch sur les codes messages    switch (msg_code) {        // Ajout de photo indisponible, sélectionnez un lot ou une opération        case 1:            infobody = '<span class="fa-stack fa-2x"><i class="fas fa-camera fa-stack-1x"></i><i class="fas fa-ban fa-stack-2x" style="color:Tomato"></i></span><p class="text-18 mb-0">Ajout de photo indisponible !</p><h4>Sélectionnez un lot ou une opération...</h4>';            break;        // Erreur de communication avec l'API        case 2:            infobody = 'Erreur de communication avec l\'API !';            break;        // Lot(s) disponible(s) dans l'application mobile        case 3:        case 4:            var pluriel = parseInt(msg_code) === 4 ? 's' : '';            infobody = '<span class="fa-stack fa-2x"><i class="fas fa-check fa-stack-2x text-success"></i><i class="fas fa-mobile fa-stack-1x text-50 gris-3"></i></span><p>Lot'+pluriel+' disponible'+pluriel+' dans l\'application mobile.</p>';            break;        // Valeur par défaut (ne doit pas arriver)        default:infobody = 'Une erreur est survenue';    } // FIN Switch    // Intégration du message et  affichage de la modale    $('#modalInfoBody').html(infobody)    $('#modalInfo').modal('show');} // FIN fonction