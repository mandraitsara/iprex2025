/** ------------------------------------------------------------------------ JS - Admin PRP Copyright (C) 2020 Intersed http://www.intersed.fr/ ------------------------------------------------------------------------ @author    Cédric Bouillon @copyright Copyright (c) 2020 Intersed @version   1.0 @since     2018 ------------------------------------------------------------------------ */$(document).ready(function() {    "use strict";    // Affiche la liste des PRP (aJax)    chargeListePrp();    // Recherche    $('.btnRecherche').click(function() {        chargeListePrp();    }); // FIN bouton recherche    $('form#filtres input[type=text]').keyup(function (e) {        var code = (e.keyCode ? e.keyCode : e.which);        if (code === 13) {            e.preventDefault();            chargeListePrp();            return false;        }    });    $('form#filtres').submit(function() {        return false;    });    // Nettoyage du contenu de la modale à sa fermeture    $('#modalPrp').on('hidden.bs.modal', function (e) {        $('#modalPrpBody').html('<i class="fa fa-spin fa-spinner fa-2x"></i>');    }); // FIN fermeture modale}); // FIN ready/** ****************************************** * Affiche la liste des PRP ****************************************** */function chargeListePrp() {    "use strict";    $.fn.ajax({        'script_execute': 'fct_prp.php',        'form_id': 'filtres',        'return_id': 'listePrp',        'done': function () {            listePrpListener();        } // FIN Callback    }); // FIN ajax    return true;} // FIN fonction/** ****************************************** * Listener de la liste des PRP ****************************************** */function listePrpListener() {    "use strict";    // Modale détails PRP    $('.btnDetailsPrp').off("click.btnDetailsPrp").on("click.btnDetailsPrp", function(e) {        e.preventDefault();        var id_prp = parseInt($(this).parents('tr').find('code').text());        if (isNaN(id_prp)) { id_prp = 0; }        if (id_prp === 0) { alert('Identification PRP échouée !'); return false; }        $.fn.ajax({            'script_execute': 'fct_prp.php',            'arguments': 'mode=showModaleDetailsPrp&id_prp='+id_prp,            'return_id': 'modalPrpBody',            done: function () {                modalePrpListener();            }        }); // FIN ajax    }); // FIN modale détails PRP    // Valider    $('.btnValiderPrp').off("click.btnValiderPrp").on("click.btnValiderPrp", function(e) {        e.preventDefault();        var id_prp = parseInt($(this).parents('tr').find('code').text());        if (isNaN(id_prp)) { id_prp = 0; }        if (id_prp === 0) { alert('Identification PRP échouée !'); return false; }        $.fn.ajax({            script_execute: 'fct_prp.php',            arguments: 'mode=validePrp&id_prp='+id_prp,            return_id:'blocValide'+id_prp        }); // FIN ajax    }); // FIN valider    // PDF    $('.btnPdfPrp').off("click.btnPdfPrp").on("click.btnPdfPrp", function(e) {        e.preventDefault();        var id_prp = parseInt($(this).parents('tr').find('code').text());        if (isNaN(id_prp)) { id_prp = 0; }        if (id_prp === 0) { alert('Identification PRP échouée !'); return false; }        var objDom = $(this).find('i.fa');        objDom.removeClass('fa-file-pdf').addClass('fa-spin fa-spinner');        $.fn.ajax({            script_execute: 'fct_prp.php',            arguments: 'mode=generePdf&id_prp='+id_prp,            callBack: function (url_fichier) {                url_fichier+='';                objDom.removeClass('fa-spin fa-spinner').addClass('fa-file-pdf');                $('#lienPdfPrp').attr('href', url_fichier);                $('#lienPdfPrp')[0].click();            }        }); // FIN ajax    }); // FIN PDF    // Pagination Ajax    $(document).on('click','#listePrp .pagination li a',function(){        if ($(this).attr('data-url') === undefined) { return false; }        // on affiche le loading d'attente        $('#listePrp').html('<i class="fa fa-spin fa-spinner fa-2x"></i>');        // on fait l'appel ajax qui va rafraichir la liste        $.fn.ajax({script_execute:'fct_prp.php'+$(this).attr('data-url'),return_id:'listePrp'});        // on désactive le lien hypertexte        return false;    }); // FIN pagination ajax} // FIN fonction// Listener de la modale détail PRPfunction modalePrpListener() {    $('#modalPrpBody .selectpicker').selectpicker('render');    $('#modalPrpBody .togglemaster').bootstrapToggle();    $("#modalPrpBody .datepicker").datepicker({        dateFormat:		"dd/mm/yy",        dayNames:			[ "Dimanche", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi" ],        dayNamesMin:		[ "Di", "Lu", "Ma", "Me", "Je", "Ve", "Sa" ],        dayNamesShort:		[ "Dim", "Lun", "Mar", "Mer", "Jeu", "Ven", "Sam" ],        firstDay:			1,        monthNames:		    [ "Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "octobre", "Novembre", "Décembre" ],        monthNamesShort:	[ "Jan", "Fév", "Mar", "Avr", "Mai", "Juin", "Juil", "Août", "Sep", "Oct", "Nov", "Déc" ],        nextText:			"Mois suivant",        prevText:			"Mois précédent",        beforeShow: function() {            setTimeout(function(){                $('.ui-datepicker').css('z-index', 10000);            }, 0);        }    }); // FIN DatePicker    $('#modalPrp').modal('show');  /*  $("#modalPrpBody select[name=id_client]").change(function () {        var id_clt = parseInt($(this).val());        if (isNaN(id_clt)) { id_clt = 0 ;}        if (id_clt === 0) { alert("Identification du client échouée, mise à jour de la liste des BL sélectionnables impossible !"); return false;}        $.fn.ajax({            'script_execute': 'fct_prp.php',            'arguments': 'mode=selectBlsByClient&id_clt='+id_clt,            'return_id': 'modalPrpSelectClt',            done: function () {                $("#modalPrpSelectClt").selectpicker('refresh');            }        }); // FIN ajax    });*/    // Save    $('.btnSavePrp').off("click.btnSavePrp").on("click.btnSavePrp", function(e) {        e.preventDefault();        $.fn.ajax({            script_execute: 'fct_prp.php',            form_id: 'modalPrpBody',            done: function () {               $('#modalPrp').modal('hide');               chargeListePrp();            }        }); // FIN ajax    });    //Suppr    $('.btnDelPrp').off("click.btnDelPrp").on("click.btnDelPrp", function(e) {        e.preventDefault();        var id_prp = parseInt($('#modalPrpBody input[name=id_prp]').val());        if (isNaN(id_prp)) { id_prp = 0; }        if (id_prp === 0) { alert("Identification du PRP échouée !"); return false; }        if (!confirm("ATTENTION !\r\nSupprimer définitivement de contrôle \r\nCette action est irreversible.")) { return false; }        $.fn.ajax({            script_execute: 'fct_prp.php',            arguments: 'mode=supprPrp&id_prp='+id_prp,            done: function () {                $('#modalPrp').modal('hide');                chargeListePrp();            }        }); // FIN ajax    });} // FIN listener