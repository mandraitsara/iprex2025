/** ------------------------------------------------------------------------ JS - Nettoyage Copyright (C) 2020 Intersed http://www.intersed.fr/ ------------------------------------------------------------------------ @author    Cédric Bouillon @copyright Copyright (c) 2020 Intersed @version   1.0 @since     2020 ------------------------------------------------------------------------ */$(document).ready(function() {    "use strict";    // Affiche la liste (aJax)    chargeListePvisu();    $('#doc').change(function () {        chargeListePvisu();    });    $('#datePvisu').change(function () {        chargeListePvisu();    });    $('#nonValides').change(function() {        chargeListePvisu();    });    // Nettoyage du contenu de la modale  à sa fermeture    $('#modalHeuresAlarmes').on('hidden.bs.modal', function (e) {        $('#modalHeuresAlarmesBody').html('<i class="fa fa-spin fa-spinner fa-2x"></i>');    }); // FIN fermeture modale    // Chargement du contenu de la modale documents du lot    $('#modalHeuresAlarmes').on('show.bs.modal', function (e) {        $.fn.ajax({            script_execute: 'fct_nettoyage.php',            arguments: 'mode=modalHeuresAlarme',            return_id: 'modalHeuresAlarmesBody',            done:function () {                modaleHeuresAlarmesListener();            }        });    });    // Recherche par date    $('#filtres .btnFiltre').off("click.btnFiltre").on("click.btnFiltre", function(e) {        e.preventDefault();        $('#datePvisu').val('');        $.fn.ajax({            script_execute: 'fct_nettoyage.php',            form_id: 'filtres',            return_id: 'listePvisu',            done: function () {                listeNettoyageListener();            } // FIN callback        });    });}); // FIN readyfunction modaleHeuresAlarmesListener() {    "use strict";    $('.selectpicker').selectpicker('render');    $('#modalHeuresAlarmes select').on('change', function () {        if (parseInt($(this).val()) === -1) {            $(this).parents('.col').addClass('hid');        }    });    $('#modalHeuresAlarmes .btnSaveHeures').off("click.btnValidation").on("click.btnValidation", function(e) {        e.preventDefault();        $.fn.ajax({            script_execute: 'fct_nettoyage.php',            form_id: 'modalHeuresAlarmesBody',            callBack:function (retour) {                retour+= '';                if (parseInt(retour) !== 1) { alert('Une erreur est survenue !\r\n'+retour); return false;}                $('#modalHeuresAlarmes').modal('hide');            }        });    });} // FIn listener/** ****************************************** * Chargement de la liste ****************************************** */function chargeListePvisu() {    "use strict";    var doc = parseInt($('#doc').val());    if (isNaN(doc)) { doc = -1; }    var datePvisu = $('#datePvisu').val().replace(/\//gi, '-');    var non_valides = $('#nonValides').is(':checked') ? 1 : 0;    $.fn.ajax({        'script_execute': 'fct_nettoyage.php',        'arguments': 'mode=showListePvisu&doc='+doc+'&date='+datePvisu+'&non_valides='+non_valides,        'return_id': 'listePvisu',        'done': function () {            listeNettoyageListener();        } // FIN callback    }); // FIN ajax    return true;} // FIN fonction/** ****************************************** * Listener de la liste ****************************************** */function listeNettoyageListener() {    "use strict";    // Validation    $('.btnValidation').off("click.btnValidation").on("click.btnValidation", function(e) {        e.preventDefault();        var type = parseInt($(this).data('type'));        var id = parseInt($(this).parents('tr').find('code').text());        if (isNaN(type)) { type = 0; }        if (isNaN(id)) { id = 0; }        if (id === 0) { alert('Identification ID échouée !');return false; }        if (type === 0) { alert('Identification du type échouée !'); return false; }        $.fn.ajax({            'script_execute': 'fct_nettoyage.php',            'arguments': 'mode=valideControle&type='+type+'&id='+id,            'return_id': 'vC'+id+'t'+type        }); // FIN ajax    }); // FIN validation    // PDF    $('.btnPdf').off("click.btnPdf").on("click.btnPdf", function(e) {        e.preventDefault();        var type = parseInt($(this).data('type'));        var id = parseInt($(this).parents('tr').find('code').text());        if (isNaN(type)) { type = 0; }        if (isNaN(id)) { id = 0; }        if (id === 0) { alert('Identification ID échouée !');return false; }        if (type === 0) { alert('Identification du type échouée !'); return false; }        $.fn.ajax({            'script_execute': 'fct_nettoyage.php',            'arguments': 'mode=generePdf&type='+type+'&id='+id,            'callBack' : function (url_fichier) {                $('#lienPdf').attr('href', url_fichier);                $('#lienPdf')[0].click();            } // FIN callBack        }); // FIN ajax    }); // FIN pdf    // Pagination Ajax    $(document).on('click','#listePvisu .pagination li a',function(){        if ($(this).attr('data-url') === undefined) { return false; }        // on affiche le loading d'attente        $('#listePvisu').html('<i class="fa fa-spin fa-spinner fa-2x"></i>');        // on fait l'appel ajax qui va rafraichir la liste        $.fn.ajax({script_execute:'fct_nettoyage.php'+$(this).attr('data-url'),return_id:'listePvisu',done:function() { listeNettoyageListener();} });        // on désactive le lien hypertexte        return false;    }); // FIN pagination ajax} // FIN listener