/** ------------------------------------------------------------------------ JS - Vue Historique Copyright (C) 2018 Intersed http://www.intersed.fr/ ------------------------------------------------------------------------ @author    Cédric Bouillon @copyright Copyright (c) 2018 Intersed @version   1.0 @since     2018 ------------------------------------------------------------------------ */$('document').ready(function() {    "use strict";        $('#clavier_virtuel').hide();        clavierVirtuel();        chargeResultats();        $('#btnGoRecherche').off("click.btngorecherche").on("click.btngorecherche", function(e) {            e.preventDefault();            chargeResultats();        });    $('#btnRazRecherche').off("click.btnrazrecherche").on("click.btnrazrecherche", function(e) {        e.preventDefault();        $('#filtre_lot').val('');        $('#filtre_froid').val('');        $('#filtre_produit').val('');        $('#filtre_date').selectpicker('val',  $('#filtre_date').data('aujourdhui'));        $('#filtre_actif_clavier').val('filtre_lot');        chargeResultats();    });}); // FIN ready/** ------------------------------------------------------------- * Clavier virtuel - adapté ------------------------------------------------------------- */function clavierVirtuel() {    $('.btn').click(function() {        $('#clavier_virtuel').hide("slide" ,{ direction: "left"  });    });    var defaultInput = $('#'+ $('#filtre_actif_clavier').val());    $('#clavier_virtuel').jkeyboard({        layout: 'francais',        input: defaultInput,        inputs:$("input"),        customLayouts: {            selectable: ["francais"],            francais: [                ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0'],                ['A', 'Z', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],                ['Q', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L', 'M'],                ['layout_switch', 'W', 'X', 'C', 'V', 'B', 'N', 'backspace'],            ],        },    });    $('#ticketLot input').click(function() {        $('#filtre_actif_clavier').val($(this).attr('id'));        $('#clavier_virtuel').show("slide" ,{ direction: "left"  });        $('#clavier_virtuel').jkeyboard("setInput", this);    });} // FIN clavier virtuel/** ------------------------------------------------------------- * Charge les résultats ------------------------------------------------------------- */function chargeResultats() {    "use strict";    $('#resultatsHist').html('<p class="text-center padding-50"><i class="fa fa-spin fa-spinner fa-3x gris-9"></i></p>');    if ($('#filtre_palette').val() === '0') { $('#filtre_palette').val(''); }    // Ajax qui charge le contenu du ticket de lot    $.fn.ajax({        'rep_script_execute': "../scripts/ajax/", // Gestion de l'URL Rewriting        'script_execute': 'fct_vue_hist.php',        'form_id': 'ticketLot',        'return_id': 'resultatsHist',        'done': function() {            resultatsListener();        }    }); // FIN ajax} // FIN fonction/** ------------------------------------------------------------- * Listener des résultats ------------------------------------------------------------- */function resultatsListener() {    // Pagination Ajax    $(document).on('click','#resultatsHist .pagination li a',function(){        if ($(this).attr('data-url') === undefined) { return false; }        // on affiche le loading d'attente        $('#listeLots').html('<i class="fa fa-spin fa-spinner fa-2x"></i>');        // on fait l'appel ajax qui va rafraichir la liste        $.fn.ajax({rep_script_execute: '../scripts/ajax/', script_execute:'fct_vue_hist.php'+$(this).attr('data-url'),return_id:'resultatsHist'});        // on désactive le lien hypertexte        return false;    }); // FIN pagination ajax    // Tri des colonnes - Produits    $('.tri-produits').off("click.triproduits'").on("click.triproduits", function(e) {        e.preventDefault();        var sens     = $(this).data('sens');        var id_froid = parseInt($(this).parents('table').data('id-froid'));        var actif    = parseInt($(this).data('tri-actif'));        // Si on change le sens du tri actif        if (actif === 1) { sens = sens === 'asc' ? 'desc' : 'asc'; }        // On change la valeur de l'input        $('input[name=colonne]').val('pdt');        $('input[name=sens]').val(sens);        // On relance la recherche        chargeResultats();    }); // FIN tri colonne produits    // Tri des colonnes - Lots    $('.tri-lots').off("click.trilots'").on("click.trilots", function(e) {        e.preventDefault();        var sens      = $(this).data('sens');        var id_froid  = parseInt($(this).parents('table').data('id-froid'));        var actif     = parseInt($(this).data('tri-actif'));        // Si on change le sens du tri actif        if (actif === 1) { sens = sens === 'asc' ? 'desc' : 'asc'; }        // On change la valeur de l'input        $('input[name=colonne]').val('lot');        $('input[name=sens]').val(sens);        // On relance la recherche        chargeResultats();    }); // FIN tri colonne lots} // FIN listener