/*   _|_|_|  _|_|_|      _|_| _|        _|    _|  _|    _|  CBO FrameWork _|        _|_|_|    _|    _|  (c) 2018 Cédric Bouillon _|        _|    _|  _|    _|   _|_|_|  _|_|_|      _|_|--------------------------------------------------------Installation du framework - Script JS------------------------------------------------------*/$(document).ready(function() {    /*****************************************     * Collapse SMTP     ****************************************/    $('#switchSmtp').on('switchChange.bootstrapSwitch', function (e, data) {        // SMTP activé        if (data === true) {            $('#collapseSmtp').collapse('show');        // SMTP désactivé        } else {            // On vérifie qu'il n'y a pas un champ en erreur avant de les masquer            var erreurs = false;            $('#collapseSmtp input').each(function() {               if ($(this).hasClass('is-invalid')) {                   $(this).removeClass('is-invalid')                   $(this).val('');               }            });            if (erreurs === false) {                $('#collapseSmtp').collapse('hide');            }        }    });    /*****************************************     * Vérification champ : Nom du site     ****************************************/    $('input[name=conf_nomsite]').blur(function() {        if ($(this).val().length > 0) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*****************************************     * Vérification champ : Domaine dev     ****************************************/    $('input[name=localhost]').blur(function() {        var regex = new RegExp("^[a-z0-9./]*$");        if (regex.test($(this).val())) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*****************************************     * Vérification champ : Domaine prod     ****************************************/    $('input[name=conf_domaine]').blur(function() {        var regex = new RegExp("^[a-z0-9./]*$");        if (regex.test($(this).val())) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : Sous-dossier projet     ******************************************/    $('input[name=conf_subdom]').blur(function() {        if ($(this).val().length === 0) {            $(this).removeClass('is-invalid');            $(this).removeClass('is-valid');            return false;        }        var regex = new RegExp("^[a-z0-9/]*$");        if (regex.test($(this).val())) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : E-mail     ******************************************/    $('input[name=conf_email]').blur(function() {        var regex = new RegExp("^[a-z0-9._-]+@[a-z0-9._-]{2,}\\.[a-z]{2,4}$");        if (regex.test($(this).val())) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : Hôte SMTP     ******************************************/    $('input[name=conf_smtp_host]').blur(function() {        var regex = new RegExp("^[a-z0-9./]*$");        if (regex.test($(this).val())) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : Port SMTP     ******************************************/    $('input[name=conf_smtp_port]').blur(function() {        var regex = new RegExp("^[0-9]{2,5}$");        if (regex.test($(this).val())) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : Utilisateur SMTP     ******************************************/    $('input[name=conf_smtp_user]').blur(function() {        if ($(this).val().length > 0) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : Mot de passe SMTP     ******************************************/    $('input[name=conf_smtp_pw]').blur(function() {        if ($(this).val().length > 0) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : Hôte SQL Dev     ******************************************/    $('input[name=conf_bdd_local_host]').blur(function() {        var regex = new RegExp("^[a-z0-9./]*$");        if (regex.test($(this).val())) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : Port SQL Dev     ******************************************/    $('input[name=conf_bdd_local_port]').blur(function() {        var regex = new RegExp("^[0-9]*$");        if (regex.test($(this).val())) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : Base SQL Dev     ******************************************/    $('input[name=conf_bdd_local_bdd]').blur(function() {        var regex = new RegExp("^[a-zA-Z0-9-_]*$");        if (regex.test($(this).val())) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : Utilisateur SQL Dev     ******************************************/    $('input[name=conf_bdd_local_user]').blur(function() {        var regex = new RegExp("^[a-zA-Z0-9-_]*$");        if (regex.test($(this).val())) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : Mot de passe SQL Dev     ******************************************/    $('input[name=conf_bdd_local_pw]').blur(function() {        if ($(this).val().length > 0) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : Hôte SQL Prod     ******************************************/    $('input[name=conf_bdd_prod_host]').blur(function() {        var regex = new RegExp("^[a-z0-9./]*$");        if (regex.test($(this).val())) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : Port SQL Prod     ******************************************/    $('input[name=conf_bdd_prod_port]').blur(function() {        var regex = new RegExp("^[0-9]*$");        if (regex.test($(this).val())) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : Base SQL Prod     ******************************************/    $('input[name=conf_bdd_prod_bdd]').blur(function() {        var regex = new RegExp("^[a-zA-Z0-9-_]*$");        if (regex.test($(this).val())) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /*******************************************     * Vérification champ : Utilisateur SQL Prod     ******************************************/    $('input[name=conf_bdd_prod_user]').blur(function() {        var regex = new RegExp("^[a-zA-Z0-9-_]*$");        if (regex.test($(this).val())) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /********************************************     * Vérification champ : Mot de passe SQL Prod     *******************************************/    $('input[name=conf_bdd_prod_pw]').blur(function() {        if ($(this).val().length > 0) {            changeValid($(this), true);        } else {            changeValid($(this), false);        }    });    /********************************************     * Test du lien PhpMyAdmin     *******************************************/    $('.btnTestPhpMyAdmin').click(function() {        var lien = $('input[name=conf_bdd_myadmin]').val();        if (lien.length === 0) { return false; }        window.open(lien, '_blank');    });    /********************************************     * Envoi mail de test     *******************************************/    $('.btnEnvoiMailTest').click(function() {        var conf_email = $('input[name=conf_email]').val();        var regex = new RegExp("^[a-z0-9._-]+@[a-z0-9._-]{2,}\\.[a-z]{2,4}$");        if (!regex.test(conf_email)) {            $('#retourTestmail').html('<span class="text-danger"><i class="fa fa-exclamation-triangle mr-1"></i> Adresse invalide !</span>');            setTimeout(function(){                $('#retourTestmail').html('');            }, 1500);            return false;        }        var conf_smtp = $('input[name=conf_smtp]').is(':checked') ? 1 : 0;        var conf_smtp_host = $('input[name=conf_smtp_host').val();        var conf_smtp_port = $('input[name=conf_smtp_port').val();        var conf_smtp_user = $('input[name=conf_smtp_user').val();        var conf_smtp_pw = $('input[name=conf_smtp_pw').val();        $.fn.ajax({            'script_execute':'fct_install.php',            'rep_script_execute': "../ajax/",            'arguments':'mode=testMail&conf_email='+conf_email+'&conf_smtp='+conf_smtp+'&conf_smtp_host='+conf_smtp_host+'&conf_smtp_port='+conf_smtp_port+'&conf_smtp_user='+conf_smtp_user+'&conf_smtp_pw='+conf_smtp_pw,            return_id:'retourTestmail',            callBack:function() {                setTimeout(function(){                    $('#retourTestmail').html('');                }, 2000);            }        }); // FIN aJax    });    /********************************************     * Test connexion BDD Dev     *******************************************/    $('.btn-test-bdd').click(function() {        var cible   = $(this).hasClass('bdd-dev') ? 'local' : 'prod';        var host    = $('input[name=conf_bdd_'+cible+'_host]').val();        var port    = $('input[name=conf_bdd_'+cible+'_port]').val();        var bdd     = $('input[name=conf_bdd_'+cible+'_bdd]').val();        var user    = $('input[name=conf_bdd_'+cible+'_user]').val();        var pw      = $('input[name=conf_bdd_'+cible+'_pw]').val();        var retour  = 'testCnxBdd_'+cible;        $.fn.ajax({            'script_execute':'fct_install.php',            'rep_script_execute': "../ajax/",            'arguments':'mode=testCnx&host='+host+'&port='+port+'&bdd='+bdd+'&user='+user+'&pw='+pw,            return_id:retour,            callBack:function() {                setTimeout(function(){                    $('#'+retour).html('&nbsp;');                }, 2000);            }        }); // FIN aJax    });}); // FIN ready/***************************************** * Fonction qui switch les classes valid ****************************************/function changeValid(champ, valide) {    "use strict";    if (valide) {        if (!champ.hasClass('is-valid')) {            champ.removeClass('is-invalid');            champ.addClass('is-valid');        }    } else {        if (!champ.hasClass('is-invalid')) {            champ.removeClass('is-valid');            champ.addClass('is-invalid');            champ.addClass('rougeTemp');            setTimeout(function(){                champ.removeClass('rougeTemp');            }, 2000);        }    }} // FIN fonction