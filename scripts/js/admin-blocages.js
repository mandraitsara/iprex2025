/** ------------------------------------------------------------------------ JS - Blocages Copyright (C) 2018 Intersed http://www.intersed.fr/ ------------------------------------------------------------------------ @author    Cédric Bouillon @copyright Copyright (c) 2018 Intersed @version   1.0 @since     2018 ------------------------------------------------------------------------ */$(document).ready(function() {    // Nettoyage du contenu de la modale à sa fermeture    $('#modalUpdTempFin').on('hidden.bs.modal', function (e) {        $('#modalUpdTempFinBody').html('<i class="fa fa-spin fa-spinner fa-2x"></i>');    }); // FIN fermeture modale    // Modale modification Temp de Fin    $('.btnUpdTempFin').off("click.btnupdtempfin").on("click.btnupdtempfin", function(e) {        e.preventDefault();        // Récupération de l'ID Froid        var id_froid = parseInt($(this).data('id-froid'));        if (isNaN(id_froid) || id_froid === 0) {            alert("Une erreur est survenur !\r\nRécupération des données impossibles.\r\nCode Erreur : MSIAQKJG");            return false;        }        $.fn.ajax({            'script_execute': 'fct_vue_cgl.php',            'arguments': 'mode=modalUpdTempFin&id_froid='+id_froid,            'return_id': 'modalUpdTempFinBody',            'done': function() {                $('.newTempFroid').focus();                modalUpdTempFinListener(id_froid);            }        }); // FIN aJax    }); // FIN click bouton edit Temp Fin}); // FIN Ready// Listener de la modalefunction modalUpdTempFinListener(id_froid) {    if (isNaN(id_froid) || id_froid === undefined) {        alert('Une erreur est survenue !\r\nIdentification du traitement impossible dans le listener.\r\n\r\nCode erreur : MUUPGADA');        return false;    }    // Bouton Enregistrer    $('.btnSaveTempFin').off("click.btnsavetempfin").on("click.btnsavetempfin", function(e) {        e.preventDefault();        $('.newTempFroid.is-invalid').removeClass('is-invalid');        var newtemp = parseFloat($('.newTempFroid').val());        var oldtemp = parseFloat($('.newTempFroid').data('old-temp'));        var ok_min =  parseFloat($('.newTempFroid').data('ok-min'));        var ok_max =  parseFloat($('.newTempFroid').data('ok-max'));        if (isNaN(newtemp) || newtemp < ok_min || newtemp > ok_max) {            $('.newTempFroid').addClass('is-invalid');            $('.newTempFroid').focus();            return false;        }        // Nouvelle Température OK        if (newtemp !== oldtemp) {            // Spinner            $('#modalUpdTempFinBody .alert').html('<i class="fa fa-spin fa-spinner mb-1"></i><br>Enregistrement en cours...');            $('.btnSaveTempFin').addClass('disabled');            // Mise à jour            $.fn.ajax({                'script_execute': 'fct_vue_cgl.php',                'arguments': 'mode=updTempFin&id_froid='+id_froid+'&temp_fin='+newtemp,                'done': function() {                    location.reload();                }            }); // FIN aJax        // Temp pas changée, on ferme juste la modale        } else {            $('#modalUpdTempFin').modal('hide');        } // FIN test température modifiée    }); // FIN bouton Save} // FIN listener