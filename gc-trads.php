<?php/**------------------------------------------------------------------------PAGE - ADMIN - Traductions GESCOMCopyright (C) 2020 Intersedhttp://www.intersed.fr/------------------------------------------------------------------------@author    Cédric Bouillon@copyright Copyright (c) 2020 Intersed@version   1.0@since     2020------------------------------------------------------------------------ */ini_set('display_errors',1);require_once 'scripts/php/config.php';require_once 'scripts/php/check_admin.php';$h1     = 'Traductions';$h1fa   = 'fa-fw fa-language';// HEADERinclude('includes/header.php');$languesManager     = new LanguesManager($cnx);$zonesManager       = new ZonesManager($cnx);$traductionsManager = new TraductionsManager($cnx);$languesManager->activeFr();$langues = $languesManager->getListeLangues(['actif' => 1]);$zones   = $zonesManager->getListeZones(['actif' => 1]);// SI update des tradsif (isset($_POST['updTrads'])) {    // Boucle sur les champs    foreach ($_POST['trad'] as $lettreScope => $trad) {        foreach ($trad as $code_zone => $trad_langues) {		    foreach ($trad_langues as $langue_id => $trad_texte) {			    $traductionsManager->saveTrad($code_zone, $langue_id, $trad_texte, $lettreScope);		    }	    }    } // FIN boucle sur les champs    $logsManager = new LogManager($cnx);    $log = new Log([]);    $log->setLog_type('info');    $log->setLog_texte('Mise à jour des traductions de zones Gescom');    $logsManager->saveLog($log);} // FIN test update des trads$traductions = $traductionsManager->getObjetTraductions();$scopes = [        'g' => 'Communs',        'b' => 'BL',        'f' => 'Facture',        'p' => 'Packing List']?><form id="formPeTradsgGc" action="<?php echo $_SERVER['PHP_SELF']; ?>" method="post">    <div class="container-fluid">        <div class="alert alert-secondary margin-top--10 row">            <div class="col-8 padding-top-5 gris-5">                <?php                if (!empty($zones) && !empty($langues)) { ?>                    <span class="badge badge-pill badge-secondary text-14"><?php echo count($zones); ?></span> zones de traductions en                    <span class="badge badge-pill badge-secondary text-14"><?php echo count($langues); ?></span> langues :                <?php }                ?>            </div>            <div class="col-4 text-right">                <button type="submit" class="btn btn-info" name="updTrads"><i class="fa fa-check mr-1"></i>Enregistrer les modifications</button>            </div>        </div>        <div class="row justify-content-md-center">            <div class="col-12">                <nav>                    <div class="nav nav-tabs" id="nav-tab" role="tablist">                        <?php                        foreach ($scopes as $lettreScope => $libelleScope) { ?>                            <a class="nav-item nav-link text-18 <?php echo $lettreScope == 'g' ? 'active' : ''; ?>" id="nav-<?php echo $lettreScope; ?>-tab" data-toggle="tab" href="#nav-<?php                            echo $lettreScope; ?>" role="tab" aria-controls="nav-<?php echo $lettreScope; ?>" aria-selected="<?php echo $lettreScope == 'g' ? 'true' : 'false'; ?>"><?php echo $libelleScope; ?></a>                        <?php } // FIN boucle scopes                        ?>                    </div>                </nav>                <div class="tab-content pt-2" id="nav-tabContent">                    <?php                    foreach ($scopes as $lettreScope => $libelleScope) { ?>                        <div class="tab-pane fade <?php echo $lettreScope == 'g' ? 'show active' : ''; ?>" id="nav-<?php echo $lettreScope; ?>" role="tabpanel" aria-labelledby="nav-<?php                        echo $lettreScope; ?>-tab">                    <div class="row">                    <?php                        // On récupère les zones du scope...                        // Boucle sur les zones                        foreach ($zones as $zone) {                            $zone_bloc = $zone->getLarge() == 1;                            $code = $zone->getCode();                            $trad = @$traductions->$lettreScope->$code;                            if (!$trad || $trad == null) { continue; }                            ?>                            <div class="col-md-6 col-lg-<?php echo $zone_bloc ? '6' : '3'; ?>">                                <div class="alert alert-secondary">                                    <div class="row">                                        <div class="col-5">                                            <i class="fa fa-columns mr-1 gris-9"></i> Nom du bloc <span class="texte-fin text-12">(zone)</span>                                        </div>                                        <div class="col-7 text-right">                                            <kbd class="bg-secondary"><?php echo $zone->getCode(); ?></kbd>                                        </div>                                        <?php foreach ($langues as $langue) {                                            $iso = $langue->getIso();                                            ?>                                            <div class="col-<?php echo $zone_bloc ? '6' : '12'; ?>">                                                <div class="input-group mt-1">                                                    <div class="input-group-prepend">                                                        <span class="input-group-text"><img src="<?php echo $langue->getDrapeau(); ?>"/></span>                                                    </div>                                                    <?php if ($zone_bloc) { ?>                                                        <textarea class="form-control no-resize" name="trad[<?php echo $lettreScope; ?>][<?php echo $code; ?>][<?php echo $langue->getId();; ?>]" ><?php echo $trad->$iso != null ? $trad->$iso :  ''; ?></textarea>                                                    <?php } else { ?>                                                        <input type="text" class="form-control" name="trad[<?php echo $lettreScope; ?>][<?php echo $code; ?>][<?php echo $langue->getId(); ?>]" value="<?php echo $trad->$iso != null ? $trad->$iso : ''; ?>">                                                    <?php } ?>                                                </div>                                            </div>                                        <?php } ?>                                    </div>                                </div>                            </div>                        <?php } // FIN boucle sur les zones                        ?>                        </div>                    </div>                <?php } // FIN boucle scopes                ?>            </div>        </div>    </div></form><?phpinclude('includes/footer.php');