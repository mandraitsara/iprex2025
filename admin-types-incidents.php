<?php/**------------------------------------------------------------------------PAGE - ADMIN - Types d'incidentsCopyright (C) 2018 Intersedhttp://www.intersed.fr/------------------------------------------------------------------------@author    Cédric Bouillon@copyright Copyright (c) 2018 Intersed@version   1.0@since     2018------------------------------------------------------------------------ */require_once 'scripts/php/config.php';// Vérifie une authentification par login/mdp adminrequire_once 'scripts/php/check_admin.php';// On restreint la page aux Administrateursif (!$utilisateur->isAdmin()) {  header('Location: index.php'); }$h1     = "Gestion des types d'incidents";$h1fa   = 'fa-fw fa-exclamation-triangle';include('includes/header.php');$incidentsManager = new IncidentsManager($cnx);$name_new_type  = isset($_REQUEST['nom'])   ? trim($_REQUEST['nom'])                 : false;$kill_type_id   = isset($_REQUEST['kt'])    ? intval(base64_decode($_REQUEST['kt'])) : false;// SI on a posté le formulaire : création d'un nouveau type de document...if ($name_new_type && $name_new_type != '') {	$actif = isset($_REQUEST['actif']) ? 1 : 0;	$incidentType = new IncidentType([]);	$incidentType->setNom($name_new_type);	$incidentType->setActif($actif);	$incidentsManager->saveTypeIncident($incidentType);} // FIN test formulaire envoyé// SI on supprime un type de documentif ($kill_type_id && (int)$kill_type_id > 0) {	$incident2kill = $incidentsManager->getTypeIncident($kill_type_id);	if ($incident2kill instanceof IncidentType) {		$incidentsManager->supprimeTypeIncident($incident2kill);	} // FIN test document instancié} // FIN test suppresion d'un doc demandé$params = ['show_inactifs' => true];$listeTypes = $incidentsManager->getListeTypesIncidents($params);?><div class="container-fluid">    <?php if (empty($listeTypes)) { ?>        <div class="alert alert-danger"><i class="fa fa-exclamation-triangle fa-lg mr-1"></i>Aucun type d'incident disponible !</div>    <?php } else { ?>    <table class="admin w-100">        <thead>            <tr>	            <?php if ($utilisateur->isDev()) { ?>                <th class="w-court-admin-cell">ID</th>	            <?php } ?>                <th>Libellé</th>                <th class="text-center">Nombre d'incidents</th>                <th class="text-center">Activation</th>                <th class="w-court-admin-cell text-center t-actions">Supprimer</th>            </tr>        </thead>        <tbody>            <?php            foreach ($listeTypes as $incident_type) {				$nbIncidents = $incidentsManager->getNbIncidentsByType($incident_type);                ?>                <tr>                    <?php if ($utilisateur->isDev()) { ?>                    <td><span class="badge badge-pill badge-warning badge-id"><?php echo $incident_type->getId(); ?></span></td>                    <?php } ?>                    <td class="text-20"><?php echo $incident_type->getNom(); ?></td>                    <td class="text-center"><span class="badge badge-pill badge-info text-16"><?php echo $nbIncidents; ?></span></td>                    <td class="text-center">                        <input type="checkbox" class="togglemaster changeActivationTypeIncident" data-toggle="toggle" data-on="Oui" data-off="Non" data-onstyle="success" data-offstyle="danger" data-type-id="<?php                        echo $incident_type->getId(); ?>" <?php echo $incident_type->getActif() == 1 ? 'checked' : ''; ?>/>                    </td>                    <td class="w-court-admin-cell text-center t-actions">                        <a href="<?php echo $_SERVER['PHP_SELF'];?>?kt=<?php echo base64_encode($incident_type->getId())?>" class="btn btn-sm btn-danger mr-1 btnSupprType <?php                        echo $nbIncidents > 0 ? 'disabled' : ''; ?>"><i class="fa fa-fw fa-lg fa-<?php                            echo $nbIncidents > 0 ? 'ban' : 'times'; ?>"></i></a>                    </td>                </tr>            <?php            } // FIN boucle            ?>        </tbody>    </table>    <?php } // FIN test types de documents trouvés    ?>    <form action="<?php echo $_SERVER['PHP_SELF']; ?>" method="post" class="alert alert-secondary mt-4">        <div class="row">            <div class="col-12 gris-7 padding-left-20 mb-1">                <i class="fa fa-plus-square mr-1 gris-7"></i>Ajouter un type d'incident&hellip;            </div>        </div>        <div class="row">            <div class="form-group col mb-0">                <div class="input-group">                    <div class="input-group-prepend">                        <span class="input-group-text"><i class="fa fa-tag"></i></span>                    </div>                    <input type="text" placeholder="Libellé" class="form-control" name="nom" value="">                </div>            </div>             <div class="form-group col mb-0">                <div class="input-group">                    <input type="checkbox" class="togglemaster" data-toggle="toggle" data-on="Activé" data-off="Désactivé" data-onstyle="success" data-offstyle="danger" name="actif" />                </div>            </div>            <div class="form-group col mb-0 text-right">                <button type="submit" class="btn btn-info"><i class="fa fa-check mr-1"></i>Ajouter</button>            </div>        </div>    </form></div><?phpinclude('includes/footer.php');