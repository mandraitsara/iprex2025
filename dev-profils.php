<?php/**------------------------------------------------------------------------PAGE - DEV - ProfilsCopyright (C) 2019 Intersedhttp://www.intersed.fr/------------------------------------------------------------------------@author    Cédric Bouillon@copyright Copyright (c) 2019 Intersed@version   1.0@since     2018------------------------------------------------------------------------ */require_once 'scripts/php/config.php';// Vérifie une authentification par login/mdp adminrequire_once 'scripts/php/check_admin.php';// On restreint la page aux Administrateurs Devéloppeursif (!$utilisateur->isDev()) {  header('Location: index.php'); }$h1     = 'Gestion des profils utilisateur';$h1fa   = 'fa-fw fa-id-card';include('includes/header.php');$profilsManager = new ProfilManager($cnx);// Si on crée un profilif (isset($_REQUEST['addProfil'])) {    $new_nom        = isset($_REQUEST['nom'])       ? trim($_REQUEST['nom'])  : '';    $new_fa         = isset($_REQUEST['fa'])        ? trim($_REQUEST['fa'])   : '';    $new_is_nett    = isset($_REQUEST['is_nett'])   ? 1 : 0;    $new_is_resp    = isset($_REQUEST['is_resp'])   ? 1 : 0;    $new_is_admin   = isset($_REQUEST['is_admin'])  ? 1 : 0;    $new_is_dev     = isset($_REQUEST['is_dev'])    ? 1 : 0;    // Si on a le minimum d'info pour créer le profil    if ($new_nom != '' && $new_fa != '') {        $new_profil = new Profil([]);		$new_profil->setNom($new_nom);		$new_profil->setFa($new_fa);		$new_profil->setIs_nett($new_is_nett);		$new_profil->setIs_resp($new_is_resp);		$new_profil->setIs_admin($new_is_admin);		$new_profil->setIs_dev($new_is_dev);		$new_niveau = 1;		if ($new_is_resp  == 1) { $new_niveau = $new_niveau + 1; }		if ($new_is_admin == 1) { $new_niveau = $new_niveau + 2; }		if ($new_is_dev   == 1) { $new_niveau = $new_niveau + 3; }		$new_profil->setNiveau($new_niveau);		$profilsManager->saveProfil($new_profil);    } // FIN test profil non vide} // FIN test création d'un profil// Si on supprime un profil (kp pour Kill Profil)if (isset($_REQUEST['kp'])) {    $kprofil_id = intval(base64_decode($_REQUEST['kp']));    $kprofil    = $profilsManager->getProfil($kprofil_id);    if ($kprofil instanceof Profil) {        // On vérifie qu'il n'ai pas d'utilisateurs liés        if ($profilsManager->getNbUserProfil($kprofil) == 0) {			$profilsManager->delProfil($kprofil);        } // FIN test aucun utilisateur avec ce profil    } // FIN test profil existe} // FIN test supprimer un profil?><div class="container-fluid">    <table class="admin w-100" id="listeProfils">        <thead>            <tr>                <th rowspan="2">ID</th>                <th rowspan="2">Libellé</th>                <th rowspan="2">Icone</th>                <th colspan="4" class="text-center">Droits</th>                <th rowspan="2" class="text-center">Niveau</th>                <th rowspan="2" class="text-center">Utilisateurs</th>                <th rowspan="2" class="text-center t-actions">Actions</th>            </tr>            <tr>                <th class="t-actions">Nettoyage</th>                <th class="t-actions">Responsable</th>                <th class="t-actions">Administrateur</th>                <th class="t-actions">Développeur</th>            </tr>        </thead>        <tbody>            <?php            foreach ($profilsManager->getListeProfils() as $profil) {                $nbUsers = $profilsManager->getNbUserProfil($profil);                ?>                <tr>                    <td><span class="badge badge-pill badge-warning badge-id"><?php echo $profil->getId(); ?></span></td>                    <td><?php echo $profil->getNom(); ?></td>                    <td><i class="fa fa-fw fa-<?php echo $profil->getFa(); ?> mr-1 gris-5"></i> <code><?php echo $profil->getFa(); ?></code></td>                    <td class="t-actions">                        <input type="checkbox" class="togglemaster" data-size="small" data-toggle="toggle" data-on="Oui" data-off="Non" data-onstyle="success" data-offstyle="danger" data-droit="is_nett" <?php                        echo (int)$profil->getIs_nett() == 1 ? 'checked' : ''; ?>/>                    </td>                    <td class="t-actions">                        <input type="checkbox" class="togglemaster" data-size="small" data-toggle="toggle" data-on="Oui" data-off="Non" data-onstyle="success" data-offstyle="danger" data-droit="is_resp" <?php                            echo (int)$profil->getIs_resp() == 1 ? 'checked' : ''; ?>/>                    </td>                    <td class="t-actions">                        <input type="checkbox" class="togglemaster" data-size="small" data-toggle="toggle" data-on="Oui" data-off="Non" data-onstyle="success" data-offstyle="danger" data-droit="is_admin" <?php                        echo (int)$profil->getIs_admin() == 1 ? 'checked' : ''; ?>/>                    </td>                    <td class="t-actions">                        <input type="checkbox" class="togglemaster" data-size="small" data-toggle="toggle" data-on="Oui" data-off="Non" data-onstyle="success" data-offstyle="danger" data-droit="is_dev" <?php                        echo (int)$profil->getIs_dev() == 1 ? 'checked' : ''; ?>/>                    </td>                    <td class="text-center"><span class="badge badge-pill text-14 badge-secondary badge-niveau"><?php echo $profil->getNiveau(); ?></span></td>                    <td class="text-center"><code class="text-14"><?php echo $nbUsers; ?></code></td>                    <td class="t-actions">                        <a href="<?php echo $_SERVER['PHP_SELF'];?>?kp=<?php echo base64_encode($profil->getId())?>" class="btn btn-sm btn-danger mr-1 btnSupprProfil <?php                            echo $nbUsers > 0 ? 'disabled' : ''; ?>"><i class="fa fa-fw fa-lg fa-<?php                            echo $nbUsers > 0 ? 'ban' : 'times'; ?>"></i></a>                    </td>                </tr>            <?php } // FIN boucle profils            ?>        </tbody>    </table>    <form action="<?php echo $_SERVER['PHP_SELF']; ?>" method="post" class="alert alert-secondary mt-4">        <div class="row">            <div class="form-group col mb-0">                <div class="input-group">                    <div class="input-group-prepend">                        <span class="input-group-text"><i class="fa fa-tag"></i></span>                    </div>                    <input type="text" placeholder="Libellé" class="form-control" name="nom" value="">                </div>            </div>            <div class="form-group ml-3 mb-0">                <div class="input-group">                    <div class="input-group-prepend">                        <span class="input-group-text"><i class="fab fa-font-awesome-flag"></i></span>                    </div>                    <input type="text" placeholder="Icone (fa-)" class="form-control" name="fa" value="">                </div>            </div>            <div class="form-group ml-3 mb-0">                <span class="input-group-text">Nettoyage<span class="ml-2"></span>                    <input type="checkbox" class="togglemaster" data-size="small" data-toggle="toggle" data-on="Oui" data-off="Non" data-onstyle="success" data-offstyle="secondary" name="is_nett" />                </span>            </div>            <div class="form-group ml-3 mb-0">                <span class="input-group-text">Responsable<span class="ml-2"></span>                    <input type="checkbox" class="togglemaster" data-size="small" data-toggle="toggle" data-on="Oui" data-off="Non" data-onstyle="success" data-offstyle="secondary" name="is_resp" />                </span>            </div>            <div class="form-group ml-3 mb-0">                <span class="input-group-text">Administrateur<span class="ml-2"></span>                    <input type="checkbox" class="togglemaster" data-size="small" data-toggle="toggle" data-on="Oui" data-off="Non" data-onstyle="success" data-offstyle="secondary" name="is_admin" />                </span>            </div>            <div class="form-group ml-3 mb-0">                <span class="input-group-text">Développeur<span class="ml-2"></span>                    <input type="checkbox" class="togglemaster" data-size="small" data-toggle="toggle" data-on="Oui" data-off="Non" data-onstyle="success" data-offstyle="secondary" name="is_dev" />                </span>            </div>            <div class="form-group col text-right mb-0">                <button type="submit" class="btn btn-info" name="addProfil"><i class="fa fa-plus-square"></i> Ajouter</button>            </div>        </div>    </form></div><?phpinclude('includes/footer.php');